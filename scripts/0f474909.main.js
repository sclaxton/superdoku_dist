/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/* Zepto v1.1.2-2-g8fa1fba - zepto event ajax form ie detect fx fx_methods assets data deferred callbacks selector touch gesture stack ios3 - zeptojs.com/license */

/*!
 * EventEmitter v4.2.8 - git.io/ee
 * Oliver Caldwell
 * MIT license
 * @preserve
 */

/**
 * @preserve Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */

/**
 * Copyright (c) 2014 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){});var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("vendor/almond/almond.js",function(){});var Zepto=function(){function _(e){return e==null?String(e):N[C.call(e)]||"object"}function D(e){return _(e)=="function"}function P(e){return e!=null&&e==e.window}function H(e){return e!=null&&e.nodeType==e.DOCUMENT_NODE}function B(e){return _(e)=="object"}function j(e){return B(e)&&!P(e)&&Object.getPrototypeOf(e)==Object.prototype}function F(e){return e instanceof Array}function I(e){return typeof e.length=="number"}function q(e){return o.call(e,function(e){return e!=null})}function R(e){return e.length>0?n.fn.concat.apply([],e):e}function U(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function z(e){return e in f?f[e]:f[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function W(e,t){return typeof t=="number"&&!l[U(e)]?t+"px":t}function X(e){var t,n;return a[e]||(t=u.createElement(e),u.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),n=="none"&&(n="block"),a[e]=n),a[e]}function V(e){return"children"in e?s.call(e.children):n.map(e.childNodes,function(e){if(e.nodeType==1)return e})}function $(n,r,i){for(t in r)i&&(j(r[t])||F(r[t]))?(j(r[t])&&!j(n[t])&&(n[t]={}),F(r[t])&&!F(n[t])&&(n[t]=[]),$(n[t],r[t],i)):r[t]!==e&&(n[t]=r[t])}function J(e,t){return t==null?n(e):n(e).filter(t)}function K(e,t,n,r){return D(t)?t.call(e,n,r):t}function Q(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function G(t,n){var r=t.className,i=r&&r.baseVal!==e;if(n===e)return i?r.baseVal:r;i?r.baseVal=n:t.className=n}function Y(e){var t;try{return e?e=="true"||(e=="false"?!1:e=="null"?null:!/^0/.test(e)&&!isNaN(t=Number(e))?t:/^[\[\{]/.test(e)?n.parseJSON(e):e):e}catch(r){return e}}function Z(e,t){t(e);for(var n in e.childNodes)Z(e.childNodes[n],t)}var e,t,n,r,i=[],s=i.slice,o=i.filter,u=window.document,a={},f={},l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},c=/^\s*<(\w+|!)[^>]*>/,h=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,p=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,d=/^(?:body|html)$/i,v=/([A-Z])/g,m=["val","css","html","text","data","width","height","offset"],g=["after","prepend","before","append"],y=u.createElement("table"),b=u.createElement("tr"),w={tr:u.createElement("tbody"),tbody:y,thead:y,tfoot:y,td:b,th:b,"*":u.createElement("div")},E=/complete|loaded|interactive/,S=/^\.([\w-]+)$/,x=/^#([\w-]*)$/,T=/^[\w-]*$/,N={},C=N.toString,k={},L,A,O=u.createElement("div"),M={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"};return k.matches=function(e,t){if(!t||!e||e.nodeType!==1)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,s=!i;return s&&(i=O).appendChild(e),r=~k.qsa(i,t).indexOf(e),s&&O.removeChild(e),r},L=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},A=function(e){return o.call(e,function(t,n){return e.indexOf(t)==n})},k.fragment=function(t,r,i){var o,a,f;return h.test(t)&&(o=n(u.createElement(RegExp.$1))),o||(t.replace&&(t=t.replace(p,"<$1></$2>")),r===e&&(r=c.test(t)&&RegExp.$1),r in w||(r="*"),f=w[r],f.innerHTML=""+t,o=n.each(s.call(f.childNodes),function(){f.removeChild(this)})),j(i)&&(a=n(o),n.each(i,function(e,t){m.indexOf(e)>-1?a[e](t):a.attr(e,t)})),o},k.Z=function(e,t){return e=e||[],e.__proto__=n.fn,e.selector=t||"",e},k.isZ=function(e){return e instanceof k.Z},k.init=function(t,r){var i;if(!t)return k.Z();if(typeof t=="string"){t=t.trim();if(t[0]=="<"&&c.test(t))i=k.fragment(t,RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=k.qsa(u,t)}}else{if(D(t))return n(u).ready(t);if(k.isZ(t))return t;if(F(t))i=q(t);else if(B(t))i=[t],t=null;else if(c.test(t))i=k.fragment(t.trim(),RegExp.$1,r),t=null;else{if(r!==e)return n(r).find(t);i=k.qsa(u,t)}}return k.Z(i,t)},n=function(e,t){return k.init(e,t)},n.extend=function(e){var t,n=s.call(arguments,1);return typeof e=="boolean"&&(t=e,e=n.shift()),n.forEach(function(n){$(e,n,t)}),e},k.qsa=function(e,t){var n,r=t[0]=="#",i=!r&&t[0]==".",o=r||i?t.slice(1):t,u=T.test(o);return H(e)&&u&&r?(n=e.getElementById(o))?[n]:[]:e.nodeType!==1&&e.nodeType!==9?[]:s.call(u&&!r?i?e.getElementsByClassName(o):e.getElementsByTagName(t):e.querySelectorAll(t))},n.contains=function(e,t){return e!==t&&e.contains(t)},n.type=_,n.isFunction=D,n.isWindow=P,n.isArray=F,n.isPlainObject=j,n.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},n.inArray=function(e,t,n){return i.indexOf.call(t,e,n)},n.camelCase=L,n.trim=function(e){return e==null?"":String.prototype.trim.call(e)},n.uuid=0,n.support={},n.expr={},n.map=function(e,t){var n,r=[],i,s;if(I(e))for(i=0;i<e.length;i++)n=t(e[i],i),n!=null&&r.push(n);else for(s in e)n=t(e[s],s),n!=null&&r.push(n);return R(r)},n.each=function(e,t){var n,r;if(I(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},n.grep=function(e,t){return o.call(e,t)},window.JSON&&(n.parseJSON=JSON.parse),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){N["[object "+t+"]"]=t.toLowerCase()}),n.fn={forEach:i.forEach,reduce:i.reduce,push:i.push,sort:i.sort,indexOf:i.indexOf,concat:i.concat,map:function(e){return n(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return n(s.apply(this,arguments))},ready:function(e){return E.test(u.readyState)&&u.body?e(n):u.addEventListener("DOMContentLoaded",function(){e(n)},!1),this},get:function(t){return t===e?s.call(this):this[t>=0?t:t+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(e){return i.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return D(e)?this.not(this.not(e)):n(o.call(this,function(t){return k.matches(t,e)}))},add:function(e,t){return n(A(this.concat(n(e,t))))},is:function(e){return this.length>0&&k.matches(this[0],e)},not:function(t){var r=[];if(D(t)&&t.call!==e)this.each(function(e){t.call(this,e)||r.push(this)});else{var i=typeof t=="string"?this.filter(t):I(t)&&D(t.item)?s.call(t):n(t);this.forEach(function(e){i.indexOf(e)<0&&r.push(e)})}return n(r)},has:function(e){return this.filter(function(){return B(e)?n.contains(this,e):n(this).find(e).size()})},eq:function(e){return e===-1?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!B(e)?e:n(e)},last:function(){var e=this[this.length-1];return e&&!B(e)?e:n(e)},find:function(e){var t,r=this;return typeof e=="object"?t=n(e).filter(function(){var e=this;return i.some.call(r,function(t){return n.contains(t,e)})}):this.length==1?t=n(k.qsa(this[0],e)):t=this.map(function(){return k.qsa(this,e)}),t},closest:function(e,t){var r=this[0],i=!1;typeof e=="object"&&(i=n(e));while(r&&!(i?i.indexOf(r)>=0:k.matches(r,e)))r=r!==t&&!H(r)&&r.parentNode;return n(r)},parents:function(e){var t=[],r=this;while(r.length>0)r=n.map(r,function(e){if((e=e.parentNode)&&!H(e)&&t.indexOf(e)<0)return t.push(e),e});return J(t,e)},parent:function(e){return J(A(this.pluck("parentNode")),e)},children:function(e){return J(this.map(function(){return V(this)}),e)},contents:function(){return this.map(function(){return s.call(this.childNodes)})},siblings:function(e){return J(this.map(function(e,t){return o.call(V(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return n.map(this,function(t){return t[e]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=""),getComputedStyle(this,"").getPropertyValue("display")=="none"&&(this.style.display=X(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var t=D(e);if(this[0]&&!t)var r=n(e).get(0),i=r.parentNode||this.length>1;return this.each(function(s){n(this).wrapAll(t?e.call(this,s):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){n(this[0]).before(e=n(e));var t;while((t=e.children()).length)e=t.first();n(e).append(this)}return this},wrapInner:function(e){var t=D(e);return this.each(function(r){var i=n(this),s=i.contents(),o=t?e.call(this,r):e;s.length?s.wrapAll(o):i.append(o)})},unwrap:function(){return this.parent().each(function(){n(this).replaceWith(n(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(t){return this.each(function(){var r=n(this);(t===e?r.css("display")=="none":t)?r.show():r.hide()})},prev:function(e){return n(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return n(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return arguments.length===0?this.length>0?this[0].innerHTML:null:this.each(function(t){var r=this.innerHTML;n(this).empty().append(K(this,e,t,r))})},text:function(t){return arguments.length===0?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=t===e?"":""+t})},attr:function(n,r){var i;return typeof n=="string"&&r===e?this.length==0||this[0].nodeType!==1?e:n=="value"&&this[0].nodeName=="INPUT"?this.val():!(i=this[0].getAttribute(n))&&n in this[0]?this[0][n]:i:this.each(function(e){if(this.nodeType!==1)return;if(B(n))for(t in n)Q(this,t,n[t]);else Q(this,n,K(this,r,e,this.getAttribute(n)))})},removeAttr:function(e){return this.each(function(){this.nodeType===1&&Q(this,e)})},prop:function(t,n){return t=M[t]||t,n===e?this[0]&&this[0][t]:this.each(function(e){this[t]=K(this,n,e,this[t])})},data:function(t,n){var r=this.attr("data-"+t.replace(v,"-$1").toLowerCase(),n);return r!==null?Y(r):e},val:function(e){return arguments.length===0?this[0]&&(this[0].multiple?n(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value):this.each(function(t){this.value=K(this,e,t,this.value)})},offset:function(e){if(e)return this.each(function(t){var r=n(this),i=K(this,e,t,r.offset()),s=r.offsetParent().offset(),o={top:i.top-s.top,left:i.left-s.left};r.css("position")=="static"&&(o.position="relative"),r.css(o)});if(this.length==0)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(e,r){if(arguments.length<2){var i=this[0],s=getComputedStyle(i,"");if(!i)return;if(typeof e=="string")return i.style[L(e)]||s.getPropertyValue(e);if(F(e)){var o={};return n.each(F(e)?e:[e],function(e,t){o[t]=i.style[L(t)]||s.getPropertyValue(t)}),o}}var u="";if(_(e)=="string")!r&&r!==0?this.each(function(){this.style.removeProperty(U(e))}):u=U(e)+":"+W(e,r);else for(t in e)!e[t]&&e[t]!==0?this.each(function(){this.style.removeProperty(U(t))}):u+=U(t)+":"+W(t,e[t])+";";return this.each(function(){this.style.cssText+=";"+u})},index:function(e){return e?this.indexOf(n(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?i.some.call(this,function(e){return this.test(G(e))},z(e)):!1},addClass:function(e){return e?this.each(function(t){r=[];var i=G(this),s=K(this,e,t,i);s.split(/\s+/g).forEach(function(e){n(this).hasClass(e)||r.push(e)},this),r.length&&G(this,i+(i?" ":"")+r.join(" "))}):this},removeClass:function(t){return this.each(function(n){if(t===e)return G(this,"");r=G(this),K(this,t,n,r).split(/\s+/g).forEach(function(e){r=r.replace(z(e)," ")}),G(this,r.trim())})},toggleClass:function(t,r){return t?this.each(function(i){var s=n(this),o=K(this,t,i,G(this));o.split(/\s+/g).forEach(function(t){(r===e?!s.hasClass(t):r)?s.addClass(t):s.removeClass(t)})}):this},scrollTop:function(t){if(!this.length)return;var n="scrollTop"in this[0];return t===e?n?this[0].scrollTop:this[0].pageYOffset:this.each(n?function(){this.scrollTop=t}:function(){this.scrollTo(this.scrollX,t)})},scrollLeft:function(t){if(!this.length)return;var n="scrollLeft"in this[0];return t===e?n?this[0].scrollLeft:this[0].pageXOffset:this.each(n?function(){this.scrollLeft=t}:function(){this.scrollTo(t,this.scrollY)})},position:function(){if(!this.length)return;var e=this[0],t=this.offsetParent(),r=this.offset(),i=d.test(t[0].nodeName)?{top:0,left:0}:t.offset();return r.top-=parseFloat(n(e).css("margin-top"))||0,r.left-=parseFloat(n(e).css("margin-left"))||0,i.top+=parseFloat(n(t[0]).css("border-top-width"))||0,i.left+=parseFloat(n(t[0]).css("border-left-width"))||0,{top:r.top-i.top,left:r.left-i.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u.body;while(e&&!d.test(e.nodeName)&&n(e).css("position")=="static")e=e.offsetParent;return e})}},n.fn.detach=n.fn.remove,["width","height"].forEach(function(t){var r=t.replace(/./,function(e){return e[0].toUpperCase()});n.fn[t]=function(i){var s,o=this[0];return i===e?P(o)?o["inner"+r]:H(o)?o.documentElement["scroll"+r]:(s=this.offset())&&s[t]:this.each(function(e){o=n(this),o.css(t,K(this,i,e,o[t]()))})}}),g.forEach(function(e,t){var r=t%2;n.fn[e]=function(){var e,i=n.map(arguments,function(t){return e=_(t),e=="object"||e=="array"||t==null?t:k.fragment(t)}),s,o=this.length>1;return i.length<1?this:this.each(function(e,u){s=r?u:u.parentNode,u=t==0?u.nextSibling:t==1?u.firstChild:t==2?u:null,i.forEach(function(e){if(o)e=e.cloneNode(!0);else if(!s)return n(e).remove();Z(s.insertBefore(e,u),function(e){e.nodeName!=null&&e.nodeName.toUpperCase()==="SCRIPT"&&(!e.type||e.type==="text/javascript")&&!e.src&&window.eval.call(window,e.innerHTML)})})})},n.fn[r?e+"To":"insert"+(t?"Before":"After")]=function(t){return n(t)[e](this),this}}),k.Z.prototype=n.fn,k.uniq=A,k.deserializeValue=Y,n.zepto=k,n}();window.Zepto=Zepto,window.$===undefined&&(window.$=Zepto),function(e){function h(e){return e._zid||(e._zid=n++)}function p(e,t,n,r){t=d(t);if(t.ns)var i=v(t.ns);return(u[h(e)]||[]).filter(function(e){return e&&(!t.e||e.e==t.e)&&(!t.ns||i.test(e.ns))&&(!n||h(e.fn)===h(n))&&(!r||e.sel==r)})}function d(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function v(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function m(e,t){return e.del&&!f&&e.e in l||!!t}function g(e){return c[e]||f&&l[e]||e}function y(t,n,i,s,o,a,f){var l=h(t),p=u[l]||(u[l]=[]);n.split(/\s/).forEach(function(n){if(n=="ready")return e(document).ready(i);var u=d(n);u.fn=i,u.sel=o,u.e in c&&(i=function(t){var n=t.relatedTarget;if(!n||n!==this&&!e.contains(this,n))return u.fn.apply(this,arguments)}),u.del=a;var l=a||i;u.proxy=function(e){e=T(e);if(e.isImmediatePropagationStopped())return;e.data=s;var n=l.apply(t,e._args==r?[e]:[e].concat(e._args));return n===!1&&(e.preventDefault(),e.stopPropagation()),n},u.i=p.length,p.push(u),"addEventListener"in t&&t.addEventListener(g(u.e),u.proxy,m(u,f))})}function b(e,t,n,r,i){var s=h(e);(t||"").split(/\s/).forEach(function(t){p(e,t,n,r).forEach(function(t){delete u[s][t.i],"removeEventListener"in e&&e.removeEventListener(g(t.e),t.proxy,m(t,i))})})}function T(t,n){if(n||!t.isDefaultPrevented){n||(n=t),e.each(x,function(e,r){var i=n[e];t[e]=function(){return this[r]=w,i&&i.apply(n,arguments)},t[r]=E});if(n.defaultPrevented!==r?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())t.isDefaultPrevented=w}return t}function N(e){var t,n={originalEvent:e};for(t in e)!S.test(t)&&e[t]!==r&&(n[t]=e[t]);return T(n,e)}var t=e.zepto.qsa,n=1,r,i=Array.prototype.slice,s=e.isFunction,o=function(e){return typeof e=="string"},u={},a={},f="onfocusin"in window,l={focus:"focusin",blur:"focusout"},c={mouseenter:"mouseover",mouseleave:"mouseout"};a.click=a.mousedown=a.mouseup=a.mousemove="MouseEvents",e.event={add:y,remove:b},e.proxy=function(t,n){if(s(t)){var r=function(){return t.apply(n,arguments)};return r._zid=h(t),r}if(o(n))return e.proxy(t[n],t);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var w=function(){return!0},E=function(){return!1},S=/^([A-Z]|returnValue$|layer[XY]$)/,x={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,u,a,f){var l,c,h=this;if(t&&!o(t))return e.each(t,function(e,t){h.on(e,n,u,t,f)}),h;!o(n)&&!s(a)&&a!==!1&&(a=u,u=n,n=r);if(s(u)||u===!1)a=u,u=r;return a===!1&&(a=E),h.each(function(r,s){f&&(l=function(e){return b(s,e.type,a),a.apply(this,arguments)}),n&&(c=function(t){var r,o=e(t.target).closest(n,s).get(0);if(o&&o!==s)return r=e.extend(N(t),{currentTarget:o,liveFired:s}),(l||a).apply(o,[r].concat(i.call(arguments,1)))}),y(s,t,a,u,n,c||l)})},e.fn.off=function(t,n,i){var u=this;return t&&!o(t)?(e.each(t,function(e,t){u.off(e,n,t)}),u):(!o(n)&&!s(i)&&i!==!1&&(i=n,n=r),i===!1&&(i=E),u.each(function(){b(this,t,i,n)}))},e.fn.trigger=function(t,n){return t=o(t)||e.isPlainObject(t)?e.Event(t):T(t),t._args=n,this.each(function(){"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,n){var r,i;return this.each(function(s,u){r=N(o(t)?e.Event(t):t),r._args=n,r.target=u,e.each(p(u,t.type||t),function(e,t){i=t.proxy(r);if(r.isImmediatePropagationStopped())return!1})}),i},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.trigger(t)}}),["focus","blur"].forEach(function(t){e.fn[t]=function(e){return e?this.bind(t,e):this.each(function(){try{this[t]()}catch(e){}}),this}}),e.Event=function(e,t){o(e)||(t=e,e=t.type);var n=document.createEvent(a[e]||"Events"),r=!0;if(t)for(var i in t)i=="bubbles"?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),T(n)}}(Zepto),function($){function triggerAndReturn(e,t,n){var r=$.Event(t);return $(e).trigger(r,n),!r.isDefaultPrevented()}function triggerGlobal(e,t,n,r){if(e.global)return triggerAndReturn(t||document,n,r)}function ajaxStart(e){e.global&&$.active++===0&&triggerGlobal(e,null,"ajaxStart")}function ajaxStop(e){e.global&&!--$.active&&triggerGlobal(e,null,"ajaxStop")}function ajaxBeforeSend(e,t){var n=t.context;if(t.beforeSend.call(n,e,t)===!1||triggerGlobal(t,n,"ajaxBeforeSend",[e,t])===!1)return!1;triggerGlobal(t,n,"ajaxSend",[e,t])}function ajaxSuccess(e,t,n,r){var i=n.context,s="success";n.success.call(i,e,s,t),r&&r.resolveWith(i,[e,s,t]),triggerGlobal(n,i,"ajaxSuccess",[t,n,e]),ajaxComplete(s,t,n)}function ajaxError(e,t,n,r,i){var s=r.context;r.error.call(s,n,t,e),i&&i.rejectWith(s,[n,t,e]),triggerGlobal(r,s,"ajaxError",[n,r,e||t]),ajaxComplete(t,n,r)}function ajaxComplete(e,t,n){var r=n.context;n.complete.call(r,t,e),triggerGlobal(n,r,"ajaxComplete",[t,n]),ajaxStop(n)}function empty(){}function mimeToDataType(e){return e&&(e=e.split(";",2)[0]),e&&(e==htmlType?"html":e==jsonType?"json":scriptTypeRE.test(e)?"script":xmlTypeRE.test(e)&&"xml")||"text"}function appendQuery(e,t){return t==""?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function serializeData(e){e.processData&&e.data&&$.type(e.data)!="string"&&(e.data=$.param(e.data,e.traditional)),e.data&&(!e.type||e.type.toUpperCase()=="GET")&&(e.url=appendQuery(e.url,e.data),e.data=undefined)}function parseArguments(e,t,n,r){var i=!$.isFunction(t);return{url:e,data:i?t:undefined,success:i?$.isFunction(n)?n:undefined:t,dataType:i?r||n:n}}function serialize(e,t,n,r){var i,s=$.isArray(t),o=$.isPlainObject(t);$.each(t,function(t,u){i=$.type(u),r&&(t=n?r:r+"["+(o||i=="object"||i=="array"?t:"")+"]"),!r&&s?e.add(u.name,u.value):i=="array"||!n&&i=="object"?serialize(e,u,n,t):e.add(t,u)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(e,t){if("type"in e){var n=e.jsonpCallback,r=($.isFunction(n)?n():n)||"jsonp"+ ++jsonpID,i=document.createElement("script"),s=window[r],o,u=function(e){$(i).triggerHandler("error",e||"abort")},a={abort:u},f;return t&&t.promise(a),$(i).on("load error",function(n,u){clearTimeout(f),$(i).off().remove(),n.type=="error"||!o?ajaxError(null,u||"error",a,e,t):ajaxSuccess(o[0],a,e,t),window[r]=s,o&&$.isFunction(s)&&s(o[0]),s=o=undefined}),ajaxBeforeSend(a,e)===!1?(u("abort"),a):(window[r]=function(){o=arguments},i.src=e.url.replace(/=\?/,"="+r),document.head.appendChild(i),e.timeout>0&&(f=setTimeout(function(){u("timeout")},e.timeout)),a)}return $.ajax(e)},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},$.ajax=function(options){var settings=$.extend({},options||{}),deferred=$.Deferred&&$.Deferred();for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host),settings.url||(settings.url=window.location.toString()),serializeData(settings),settings.cache===!1&&(settings.url=appendQuery(settings.url,"_="+Date.now()));var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,settings.jsonp?settings.jsonp+"=?":settings.jsonp===!1?"":"callback=?")),$.ajaxJSONP(settings,deferred);var mime=settings.accepts[dataType],headers={},setHeader=function(e,t){headers[e.toLowerCase()]=[e,t]},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),nativeSetHeader=xhr.setRequestHeader,abortTimeout;deferred&&deferred.promise(xhr),settings.crossDomain||setHeader("X-Requested-With","XMLHttpRequest"),setHeader("Accept",mime||"*/*");if(mime=settings.mimeType||mime)mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime);(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")&&setHeader("Content-Type",settings.contentType||"application/x-www-form-urlencoded");if(settings.headers)for(name in settings.headers)setHeader(name,settings.headers[name]);xhr.setRequestHeader=setHeader,xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty,clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(settings.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings,deferred):ajaxSuccess(result,xhr,settings,deferred)}else ajaxError(xhr.statusText||null,xhr.status?"error":"abort",xhr,settings,deferred)}};if(ajaxBeforeSend(xhr,settings)===!1)return xhr.abort(),ajaxError(null,"abort",xhr,settings,deferred),xhr;if(settings.xhrFields)for(name in settings.xhrFields)xhr[name]=settings.xhrFields[name];var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async,settings.username,settings.password);for(name in headers)nativeSetHeader.apply(xhr,headers[name]);return settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings,deferred)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr},$.get=function(e,t,n,r){return $.ajax(parseArguments.apply(null,arguments))},$.post=function(e,t,n,r){var i=parseArguments.apply(null,arguments);return i.type="POST",$.ajax(i)},$.getJSON=function(e,t,n){var r=parseArguments.apply(null,arguments);return r.dataType="json",$.ajax(r)},$.fn.load=function(e,t,n){if(!this.length)return this;var r=this,i=e.split(/\s/),s,o=parseArguments(e,t,n),u=o.success;return i.length>1&&(o.url=i[0],s=i[1]),o.success=function(e){r.html(s?$("<div>").html(e.replace(rscript,"")).find(s):e),u&&u.apply(r,arguments)},$.ajax(o),this};var escape=encodeURIComponent;$.param=function(e,t){var n=[];return n.add=function(e,t){this.push(escape(e)+"="+escape(t))},serialize(n,e,t),n.join("&").replace(/%20/g,"+")}}(Zepto),function(e){e.fn.serializeArray=function(){var t=[],n;return e([].slice.call(this.get(0).elements)).each(function(){n=e(this);var r=n.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&r!="submit"&&r!="reset"&&r!="button"&&(r!="radio"&&r!="checkbox"||this.checked)&&t.push({name:n.attr("name"),value:n.val()})}),t},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(t)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){return t=t||[],e.extend(t,e.fn),t.selector=n||"",t.__Z=!0,t},isZ:function(t){return e.type(t)==="array"&&"__Z"in t}});try{getComputedStyle(undefined)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}}(Zepto),function(e){function t(e){var t=this.os={},n=this.browser={},r=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),i=e.match(/(Android);?[\s\/]+([\d.]+)?/),s=e.match(/(iPad).*OS\s([\d_]+)/),o=e.match(/(iPod)(.*OS\s([\d_]+))?/),u=!s&&e.match(/(iPhone\sOS)\s([\d_]+)/),a=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),f=a&&e.match(/TouchPad/),l=e.match(/Kindle\/([\d.]+)/),c=e.match(/Silk\/([\d._]+)/),h=e.match(/(BlackBerry).*Version\/([\d.]+)/),p=e.match(/(BB10).*Version\/([\d.]+)/),d=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),v=e.match(/PlayBook/),m=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),g=e.match(/Firefox\/([\d.]+)/),y=e.match(/MSIE ([\d.]+)/),b=r&&e.match(/Mobile\//)&&!m,w=e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/)&&!m,y=e.match(/MSIE\s([\d.]+)/);if(n.webkit=!!r)n.version=r[1];i&&(t.android=!0,t.version=i[2]),u&&!o&&(t.ios=t.iphone=!0,t.version=u[2].replace(/_/g,".")),s&&(t.ios=t.ipad=!0,t.version=s[2].replace(/_/g,".")),o&&(t.ios=t.ipod=!0,t.version=o[3]?o[3].replace(/_/g,"."):null),a&&(t.webos=!0,t.version=a[2]),f&&(t.touchpad=!0),h&&(t.blackberry=!0,t.version=h[2]),p&&(t.bb10=!0,t.version=p[2]),d&&(t.rimtabletos=!0,t.version=d[2]),v&&(n.playbook=!0),l&&(t.kindle=!0,t.version=l[1]),c&&(n.silk=!0,n.version=c[1]),!c&&t.android&&e.match(/Kindle Fire/)&&(n.silk=!0),m&&(n.chrome=!0,n.version=m[1]),g&&(n.firefox=!0,n.version=g[1]),y&&(n.ie=!0,n.version=y[1]),b&&(e.match(/Safari/)||!!t.ios)&&(n.safari=!0),w&&(n.webview=!0),y&&(n.ie=!0,n.version=y[1]),t.tablet=!!(s||v||i&&!e.match(/Mobile/)||g&&e.match(/Tablet/)||y&&!e.match(/Phone/)&&e.match(/Touch/)),t.phone=!!(!t.tablet&&!t.ipod&&(i||u||a||h||p||m&&e.match(/Android/)||m&&e.match(/CriOS\/([\d.]+)/)||g&&e.match(/Mobile/)||y&&e.match(/Touch/)))}t.call(e,navigator.userAgent),e.__detect=t}(Zepto),function(e,t){function w(e){return e.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase()}function E(e){return r?r+e:e.toLowerCase()}var n="",r,i,s,o={Webkit:"webkit",Moz:"",O:"o"},u=window.document,a=u.createElement("div"),f=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,l,c,h,p,d,v,m,g,y,b={};e.each(o,function(e,i){if(a.style[e+"TransitionProperty"]!==t)return n="-"+e.toLowerCase()+"-",r=i,!1}),l=n+"transform",b[c=n+"transition-property"]=b[h=n+"transition-duration"]=b[d=n+"transition-delay"]=b[p=n+"transition-timing-function"]=b[v=n+"animation-name"]=b[m=n+"animation-duration"]=b[y=n+"animation-delay"]=b[g=n+"animation-timing-function"]="",e.fx={off:r===t&&a.style.transitionProperty===t,speeds:{_default:400,fast:200,slow:600},cssPrefix:n,transitionEnd:E("TransitionEnd"),animationEnd:E("AnimationEnd")},e.fn.animate=function(n,r,i,s,o){return e.isFunction(r)&&(s=r,i=t,r=t),e.isFunction(i)&&(s=i,i=t),e.isPlainObject(r)&&(i=r.easing,s=r.complete,o=r.delay,r=r.duration),r&&(r=(typeof r=="number"?r:e.fx.speeds[r]||e.fx.speeds._default)/1e3),o&&(o=parseFloat(o)/1e3),this.anim(n,r,i,s,o)},e.fn.anim=function(n,r,i,s,o){var u,a={},E,S="",x=this,T,N=e.fx.transitionEnd,C=!1;r===t&&(r=e.fx.speeds._default/1e3),o===t&&(o=0),e.fx.off&&(r=0);if(typeof n=="string")a[v]=n,a[m]=r+"s",a[y]=o+"s",a[g]=i||"linear",N=e.fx.animationEnd;else{E=[];for(u in n)f.test(u)?S+=u+"("+n[u]+") ":(a[u]=n[u],E.push(w(u)));S&&(a[l]=S,E.push(l)),r>0&&typeof n=="object"&&(a[c]=E.join(", "),a[h]=r+"s",a[d]=o+"s",a[p]=i||"linear")}return T=function(t){if(typeof t!="undefined"){if(t.target!==t.currentTarget)return;e(t.target).unbind(N,T)}else e(this).unbind(N,T);C=!0,e(this).css(b),s&&s.call(this)},r>0&&(this.bind(N,T),setTimeout(function(){if(C)return;T.call(x)},r*1e3+25)),this.size()&&this.get(0).clientLeft,this.css(a),r<=0&&setTimeout(function(){x.each(function(){T.call(this)})},0),this},a=null}(Zepto),function(e,t){function u(n,r,i,s,o){typeof r=="function"&&!o&&(o=r,r=t);var u={opacity:i};return s&&(u.scale=s,n.css(e.fx.cssPrefix+"transform-origin","0 0")),n.animate(u,r,null,o)}function a(t,n,r,i){return u(t,n,0,r,function(){s.call(e(this)),i&&i.call(this)})}var n=window.document,r=n.documentElement,i=e.fn.show,s=e.fn.hide,o=e.fn.toggle;e.fn.show=function(e,n){return i.call(this),e===t?e=0:this.css("opacity",0),u(this,e,1,"1,1",n)},e.fn.hide=function(e,n){return e===t?s.call(this):a(this,e,"0,0",n)},e.fn.toggle=function(n,r){return n===t||typeof n=="boolean"?o.call(this,n):this.each(function(){var t=e(this);t[t.css("display")=="none"?"show":"hide"](n,r)})},e.fn.fadeTo=function(e,t,n){return u(this,e,t,null,n)},e.fn.fadeIn=function(e,t){var n=this.css("opacity");return n>0?this.css("opacity",0):n=1,i.call(this).fadeTo(e,n,t)},e.fn.fadeOut=function(e,t){return a(this,e,null,t)},e.fn.fadeToggle=function(t,n){return this.each(function(){var r=e(this);r[r.css("opacity")==0||r.css("display")=="none"?"fadeIn":"fadeOut"](t,n)})}}(Zepto),function(e){var t=[],n;e.fn.remove=function(){return this.each(function(){this.parentNode&&(this.tagName==="IMG"&&(t.push(this),this.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",n&&clearTimeout(n),n=setTimeout(function(){t=[]},6e4)),this.parentNode.removeChild(this))})}}(Zepto),function(e){function o(s,o){var a=s[i],f=a&&t[a];if(o===undefined)return f||u(s);if(f){if(o in f)return f[o];var l=r(o);if(l in f)return f[l]}return n.call(e(s),o)}function u(n,s,o){var u=n[i]||(n[i]=++e.uuid),f=t[u]||(t[u]=a(n));return s!==undefined&&(f[r(s)]=o),f}function a(t){var n={};return e.each(t.attributes||s,function(t,i){i.name.indexOf("data-")==0&&(n[r(i.name.replace("data-",""))]=e.zepto.deserializeValue(i.value))}),n}var t={},n=e.fn.data,r=e.camelCase,i=e.expando="Zepto"+ +(new Date),s=[];e.fn.data=function(t,n){return n===undefined?e.isPlainObject(t)?this.each(function(n,r){e.each(t,function(e,t){u(r,e,t)})}):this.length==0?undefined:o(this[0],t):this.each(function(){u(this,t,n)})},e.fn.removeData=function(n){return typeof n=="string"&&(n=n.split(/\s+/)),this.each(function(){var s=this[i],o=s&&t[s];o&&e.each(n||o,function(e){delete o[n?r(this):e]})})},["remove","empty"].forEach(function(t){var n=e.fn[t];e.fn[t]=function(){var e=this.find("*");return t==="remove"&&(e=e.add(this)),e.removeData(),n.call(this)}})}(Zepto),function(e){function n(t){var r=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],i="pending",s={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var t=arguments;return n(function(n){e.each(r,function(r,i){var u=e.isFunction(t[r])&&t[r];o[i[1]](function(){var t=u&&u.apply(this,arguments);if(t&&e.isFunction(t.promise))t.promise().done(n.resolve).fail(n.reject).progress(n.notify);else{var r=this===s?n.promise():this,o=u?[t]:arguments;n[i[0]+"With"](r,o)}})}),t=null}).promise()},promise:function(t){return t!=null?e.extend(t,s):s}},o={};return e.each(r,function(e,t){var n=t[2],u=t[3];s[t[1]]=n.add,u&&n.add(function(){i=u},r[e^1][2].disable,r[2][2].lock),o[t[0]]=function(){return o[t[0]+"With"](this===o?s:this,arguments),this},o[t[0]+"With"]=n.fireWith}),s.promise(o),t&&t.call(o,o),o}var t=Array.prototype.slice;e.when=function(r){var i=t.call(arguments),s=i.length,o=0,u=s!==1||r&&e.isFunction(r.promise)?s:0,a=u===1?r:n(),f,l,c,h=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?t.call(arguments):i,r===f?a.notifyWith(n,r):--u||a.resolveWith(n,r)}};if(s>1){f=new Array(s),l=new Array(s),c=new Array(s);for(;o<s;++o)i[o]&&e.isFunction(i[o].promise)?i[o].promise().done(h(o,c,i)).fail(a.reject).progress(h(o,l,f)):--u}return u||a.resolveWith(c,i),a.promise()},e.Deferred=n}(Zepto),function(e){e.Callbacks=function(t){t=e.extend({},t);var n,r,i,s,o,u,a=[],f=!t.once&&[],l=function(e){n=t.memory&&e,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;++u)if(a[u].apply(e[0],e[1])===!1&&t.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a.length=0:c.disable())},c={add:function(){if(a){var r=a.length,u=function(n){e.each(n,function(e,n){typeof n=="function"?(!t.unique||!c.has(n))&&a.push(n):n&&n.length&&typeof n!="string"&&u(n)})};u(arguments),i?o=a.length:n&&(s=r,l(n))}return this},remove:function(){return a&&e.each(arguments,function(t,n){var r;while((r=e.inArray(n,a,r))>-1)a.splice(r,1),i&&(r<=o&&--o,r<=u&&--u)}),this},has:function(t){return!!a&&!!(t?e.inArray(t,a)>-1:a.length)},empty:function(){return o=a.length=0,this},disable:function(){return a=f=n=undefined,this},disabled:function(){return!a},lock:function(){return f=undefined,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return a&&(!r||f)&&(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!r}};return c}}(Zepto),function(e){function i(t){return t=e(t),(!!t.width()||!!t.height())&&t.css("display")!=="none"}function f(e,t){e=e.replace(/=#\]/g,'="#"]');var n,r,i=o.exec(e);if(i&&i[2]in s){n=s[i[2]],r=i[3],e=i[1];if(r){var u=Number(r);isNaN(u)?r=r.replace(/^["']|["']$/g,""):r=u}}return t(e,n,r)}var t=e.zepto,n=t.qsa,r=t.matches,s=e.expr[":"]={visible:function(){if(i(this))return this},hidden:function(){if(!i(this))return this},selected:function(){if(this.selected)return this},checked:function(){if(this.checked)return this},parent:function(){return this.parentNode},first:function(e){if(e===0)return this},last:function(e,t){if(e===t.length-1)return this},eq:function(e,t,n){if(e===n)return this},contains:function(t,n,r){if(e(this).text().indexOf(r)>-1)return this},has:function(e,n,r){if(t.qsa(this,r).length)return this}},o=new RegExp("(.*):(\\w+)(?:\\(([^)]+)\\))?$\\s*"),u=/^\s*>/,a="Zepto"+ +(new Date);t.qsa=function(r,i){return f(i,function(s,o,f){try{var l;!s&&o?s="*":u.test(s)&&(l=e(r).addClass(a),s="."+a+" "+s);var c=n(r,s)}catch(h){throw console.error("error performing selector: %o",i),h}finally{l&&l.removeClass(a)}return o?t.uniq(e.map(c,function(e,t){return o.call(e,t,c,f)})):c})},t.matches=function(e,t){return f(t,function(t,n,i){return(!t||r(e,t))&&(!n||n.call(e,null,i)===e)})}}(Zepto),function(e){function a(e,t,n,r){return Math.abs(e-t)>=Math.abs(n-r)?e-t>0?"Left":"Right":n-r>0?"Up":"Down"}function f(){s=null,t.last&&(t.el.trigger("longTap"),t={})}function l(){s&&clearTimeout(s),s=null}function c(){n&&clearTimeout(n),r&&clearTimeout(r),i&&clearTimeout(i),s&&clearTimeout(s),n=r=i=s=null,t={}}function h(e){return(e.pointerType=="touch"||e.pointerType==e.MSPOINTER_TYPE_TOUCH)&&e.isPrimary}function p(e,t){return e.type=="pointer"+t||e.type.toLowerCase()=="mspointer"+t}var t={},n,r,i,s,o=750,u;e(document).ready(function(){var d,v,m=0,g=0,y,b;"MSGesture"in window&&(u=new MSGesture,u.target=document.body),e(document).bind("MSGestureEnd",function(e){var n=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;n&&(t.el.trigger("swipe"),t.el.trigger("swipe"+n))}).on("touchstart MSPointerDown pointerdown",function(r){if((b=p(r,"down"))&&!h(r))return;y=b?r:r.touches[0],r.touches&&r.touches.length===1&&t.x2&&(t.x2=undefined,t.y2=undefined),d=Date.now(),v=d-(t.last||d),t.el=e("tagName"in y.target?y.target:y.target.parentNode),n&&clearTimeout(n),t.x1=y.pageX,t.y1=y.pageY,v>0&&v<=250&&(t.isDoubleTap=!0),t.last=d,s=setTimeout(f,o),u&&b&&u.addPointer(r.pointerId)}).on("touchmove MSPointerMove pointermove",function(e){if((b=p(e,"move"))&&!h(e))return;y=b?e:e.touches[0],l(),t.x2=y.pageX,t.y2=y.pageY,m+=Math.abs(t.x1-t.x2),g+=Math.abs(t.y1-t.y2)}).on("touchend MSPointerUp pointerup",function(s){if((b=p(s,"up"))&&!h(s))return;l(),t.x2&&Math.abs(t.x1-t.x2)>30||t.y2&&Math.abs(t.y1-t.y2)>30?i=setTimeout(function(){t.el.trigger("swipe"),t.el.trigger("swipe"+a(t.x1,t.x2,t.y1,t.y2)),t={}},0):"last"in t&&(m<30&&g<30?r=setTimeout(function(){var r=e.Event("tap");r.cancelTouch=c,t.el.trigger(r),t.isDoubleTap?(t.el&&t.el.trigger("doubleTap"),t={}):n=setTimeout(function(){n=null,t.el&&t.el.trigger("singleTap"),t={}},250)},0):t={}),m=g=0}).on("touchcancel MSPointerCancel pointercancel",c),e(window).on("scroll",c)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){e.fn[t]=function(e){return this.on(t,e)}})}(Zepto),function(e){if(e.os.ios){var t={},n;function r(e){return"tagName"in e?e:e.parentNode}e(document).bind("gesturestart",function(e){var i=Date.now(),s=i-(t.last||i);t.target=r(e.target),n&&clearTimeout(n),t.e1=e.scale,t.last=i}).bind("gesturechange",function(e){t.e2=e.scale}).bind("gestureend",function(n){t.e2>0?(Math.abs(t.e1-t.e2)!=0&&e(t.target).trigger("pinch")&&e(t.target).trigger("pinch"+(t.e1-t.e2>0?"In":"Out")),t.e1=t.e2=t.last=0):"last"in t&&(t={})}),["pinch","pinchIn","pinchOut"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}})}}(Zepto),function(e){e.fn.end=function(){return this.prevObject||e()},e.fn.andSelf=function(){return this.add(this.prevObject||e())},"filter,add,not,eq,first,last,find,closest,parents,parent,children,siblings".split(",").forEach(function(t){var n=e.fn[t];e.fn[t]=function(){var e=n.apply(this,arguments);return e.prevObject=this,e}})}(Zepto),function(e){String.prototype.trim===e&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===e&&(Array.prototype.reduce=function(t){if(this===void 0||this===null)throw new TypeError;var n=Object(this),r=n.length>>>0,i=0,s;if(typeof t!="function")throw new TypeError;if(r==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)s=arguments[1];else do{if(i in n){s=n[i++];break}if(++i>=r)throw new TypeError}while(!0);while(i<r)i in n&&(s=t.call(e,s,n[i],i,n)),i++;return s})}(),define("zepto",function(e){return function(){var t,n;return t||e.Zepto}}(this)),function(){function e(){}function i(e,t){var n=e.length;while(n--)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}var t=e.prototype,n=this,r=n.EventEmitter;t.getListeners=function(t){var n=this._getEvents(),r,i;if(t instanceof RegExp){r={};for(i in n)n.hasOwnProperty(i)&&t.test(i)&&(r[i]=n[i])}else r=n[t]||(n[t]=[]);return r},t.flattenListeners=function(t){var n=[],r;for(r=0;r<t.length;r+=1)n.push(t[r].listener);return n},t.getListenersAsObject=function(t){var n=this.getListeners(t),r;return n instanceof Array&&(r={},r[t]=n),r||n},t.addListener=function(t,n){var r=this.getListenersAsObject(t),s=typeof n=="object",o;for(o in r)r.hasOwnProperty(o)&&i(r[o],n)===-1&&r[o].push(s?n:{listener:n,once:!1});return this},t.on=s("addListener"),t.addOnceListener=function(t,n){return this.addListener(t,{listener:n,once:!0})},t.once=s("addOnceListener"),t.defineEvent=function(t){return this.getListeners(t),this},t.defineEvents=function(t){for(var n=0;n<t.length;n+=1)this.defineEvent(t[n]);return this},t.removeListener=function(t,n){var r=this.getListenersAsObject(t),s,o;for(o in r)r.hasOwnProperty(o)&&(s=i(r[o],n),s!==-1&&r[o].splice(s,1));return this},t.off=s("removeListener"),t.addListeners=function(t,n){return this.manipulateListeners(!1,t,n)},t.removeListeners=function(t,n){return this.manipulateListeners(!0,t,n)},t.manipulateListeners=function(t,n,r){var i,s,o=t?this.removeListener:this.addListener,u=t?this.removeListeners:this.addListeners;if(typeof n!="object"||n instanceof RegExp){i=r.length;while(i--)o.call(this,n,r[i])}else for(i in n)n.hasOwnProperty(i)&&(s=n[i])&&(typeof s=="function"?o.call(this,i,s):u.call(this,i,s));return this},t.removeEvent=function(t){var n=typeof t,r=this._getEvents(),i;if(n==="string")delete r[t];else if(t instanceof RegExp)for(i in r)r.hasOwnProperty(i)&&t.test(i)&&delete r[i];else delete this._events;return this},t.removeAllListeners=s("removeEvent"),t.emitEvent=function(t,n){var r=this.getListenersAsObject(t),i,s,o,u;for(o in r)if(r.hasOwnProperty(o)){s=r[o].length;while(s--)i=r[o][s],i.once===!0&&this.removeListener(t,i.listener),u=i.listener.apply(this,n||[]),u===this._getOnceReturnValue()&&this.removeListener(t,i.listener)}return this},t.trigger=s("emitEvent"),t.emit=function(t){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,n)},t.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},t._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},t._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return n.EventEmitter=r,e},typeof define=="function"&&define.amd?define("eventEmitter",[],function(){return e}):typeof module=="object"&&module.exports?module.exports=e:this.EventEmitter=e}.call(this),define("events",["eventEmitter"],function(e){var t=new e;return t.defineEvents(["win","move","undo","reset","numpad","modelUpdate","selectSquare","viewUpdate"]),{dispatcher:t}}),!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("bluebird",e):"undefined"!=typeof window?window.P=window.Promise=e():"undefined"!=typeof global?global.P=global.Promise=e():"undefined"!=typeof self&&(self.P=self.Promise=e())}(function(){var define,module,exports;return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){t.exports=function(e){function n(e){var n=new t(e),r=n.promise();return r.isRejected()?r:(n.setHowMany(1),n.setUnwrap(),n.init(),r)}var t=e._SomePromiseArray;e.any=function(t){return n(t)},e.prototype.any=function(){return n(this)}}},{}],2:[function(e,t,n){function a(){this._isTickUsed=!1,this._schedule=r,this._length=0,this._lateBuffer=new i(16),this._functionBuffer=new i(65536);var e=this;this.consumeFunctionBuffer=function(){e._consumeFunctionBuffer()}}var r=e("./schedule.js"),i=e("./queue.js"),s=e("./util.js").errorObj,o=e("./util.js").tryCatch1,u=typeof process!="undefined"?process:void 0;a.prototype.haveItemsQueued=function(){return this._length>0},a.prototype.invokeLater=function(t,n,r){u!==void 0&&u.domain!=null&&!t.domain&&(t=u.domain.bind(t)),this._lateBuffer.push(t,n,r),this._queueTick()},a.prototype.invoke=function(t,n,r){u!==void 0&&u.domain!=null&&!t.domain&&(t=u.domain.bind(t));var i=this._functionBuffer;i.push(t,n,r),this._length=i.length(),this._queueTick()},a.prototype._consumeFunctionBuffer=function(){var t=this._functionBuffer;while(t.length()>0){var n=t.shift(),r=t.shift(),i=t.shift();n.call(r,i)}this._reset(),this._consumeLateBuffer()},a.prototype._consumeLateBuffer=function(){var t=this._lateBuffer;while(t.length()>0){var n=t.shift(),r=t.shift(),i=t.shift(),u=o(n,r,i);if(u===s){this._queueTick();if(n.domain==null)throw u.e;n.domain.emit("error",u.e)}}},a.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},a.prototype._reset=function(){this._isTickUsed=!1,this._length=0},t.exports=new a},{"./queue.js":25,"./schedule.js":28,"./util.js":35}],3:[function(e,t,n){var r=e("./promise.js")();t.exports=r},{"./promise.js":20}],4:[function(e,t,n){var r=Object.create;if(r){var i=r(null),s=r(null);i[" size"]=s[" size"]=0}t.exports=function(t){function u(e){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,e))}function a(e){return new Function("obj","                                             \n                                                                \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))}function f(e,t,n){var r=n[e];if(typeof r!="function"){if(!o(e))return null;r=t(e),n[e]=r,n[" size"]++;if(n[" size"]>512){var i=Object.keys(n);for(var s=0;s<256;++s)delete n[i[s]];n[" size"]=i.length-256}}return r}function l(e){return f(e,u,i)}function c(e){return f(e,a,s)}function h(e){return e[this.pop()].apply(e,this)}function p(e){return e[this]}function d(e){return e[this]}var n=e("./util.js"),r=n.canEvaluate,o=n.isIdentifier;t.prototype.call=function(t){var n=arguments.length,i=new Array(n-1);for(var s=1;s<n;++s)i[s-1]=arguments[s];if(r){var o=l(t);if(o!==null)return this._then(o,void 0,void 0,i,void 0)}return i.push(t),this._then(h,void 0,void 0,i,void 0)},t.prototype.get=function(t){var n=typeof t=="number",i;if(!n)if(r){var s=c(t);i=s!==null?s:p}else i=p;else i=d;return this._then(i,void 0,void 0,t,void 0)}}},{"./util.js":35}],5:[function(e,t,n){t.exports=function(t,n){var r=e("./errors.js"),i=r.canAttach,s=e("./async.js"),o=r.CancellationError;t.prototype._cancel=function(t){if(!this.isCancellable())return this;var n,r=this;while((n=r._cancellationParent)!==void 0&&n.isCancellable())r=n;r._attachExtraTrace(t),r._rejectUnchecked(t)},t.prototype.cancel=function(t){return this.isCancellable()?(t=t!==void 0?i(t)?t:new Error(t+""):new o,s.invokeLater(this._cancel,this,t),this):this},t.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},t.prototype.uncancellable=function(){var r=new t(n);return r._propagateFrom(this,6),r._follow(this),r._unsetCancellable(),r},t.prototype.fork=function(t,n,r){var i=this._then(t,n,r,void 0,void 0);return i._setCancellable(),i._cancellationParent=void 0,i}}},{"./async.js":2,"./errors.js":10}],6:[function(e,t,n){t.exports=function(){function o(e){var t;if(typeof e=="function")t="[function "+(e.name||"anonymous")+"]";else{t=e.toString();var n=/\[object [a-zA-Z0-9$_]+\]/;if(n.test(t))try{var r=JSON.stringify(e);t=r}catch(i){}t.length===0&&(t="(empty array)")}return"(<"+u(t)+">, no stack trace)"}function u(e){var t=41;return e.length<t?e:e.substr(0,t-3)+"..."}function a(e,t){this.captureStackTrace(a,t)}var t=e("./util.js").inherits,n=e("./es5.js").defineProperty,r=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),i=null,s=null;t(a,Error),a.prototype.captureStackTrace=function(t,n){f(this,t,n)},a.possiblyUnhandledRejection=function(t){if(typeof console=="object"){var n;if(typeof t=="object"||typeof t=="function"){var r=t.stack;n="Possibly unhandled "+s(r,t)}else n="Possibly unhandled "+String(t);typeof console.error=="function"||typeof console.error=="object"?console.error(n):(typeof console.log=="function"||typeof console.log=="object")&&console.log(n)}},a.combine=function(t,n){var s=t.length-1;for(var o=n.length-1;o>=0;--o){var u=n[o];if(t[s]!==u)break;t.pop(),s--}t.push("From previous event:");var a=t.concat(n),f=[];for(var o=0,l=a.length;o<l;++o){if(r.test(a[o])&&i.test(a[o])||o>0&&!i.test(a[o])&&a[o]!=="From previous event:")continue;f.push(a[o])}return f},a.protectErrorMessageNewlines=function(e){for(var t=0;t<e.length;++t)if(i.test(e[t]))break;if(t<=1)return;var n=[];for(var r=0;r<t;++r)n.push(e.shift());e.unshift(n.join("\0"))},a.isSupported=function(){return typeof f=="function"};var f=function l(){if(typeof Error.stackTraceLimit=="number"&&typeof Error.captureStackTrace=="function"){i=/^\s*at\s*/,s=function(e,t){return typeof e=="string"?e:t.name!==void 0&&t.message!==void 0?t.name+". "+t.message:o(t)};var e=Error.captureStackTrace;return function(n,r){e(n,r)}}var t=new Error;if(typeof t.stack=="string"&&typeof "".startsWith=="function"&&t.stack.startsWith("stackDetection@")&&l.name==="stackDetection"){n(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),i=/@/;var r=/[@\n]/;return s=function(e,t){return typeof e=="string"?t.name+". "+t.message+"\n"+e:t.name!==void 0&&t.message!==void 0?t.name+". "+t.message:o(t)},function(t){var n=(new Error).stack,i=n.split(r),s=i.length,o="";for(var u=0;u<s;u+=2)o+=i[u],o+="@",o+=i[u+1],o+="\n";t.stack=o}}return s=function(e,t){return typeof e=="string"?e:typeof t!="object"&&typeof t!="function"||t.name===void 0||t.message===void 0?o(t):t.name+". "+t.message},null}();return a}},{"./es5.js":12,"./util.js":35}],7:[function(e,t,n){t.exports=function(t){function a(e,t,n){this._instances=e,this._callback=t,this._promise=n}function f(e,t){var n={},r=i(e,n,t);if(r===s)return r;var a=o(n);return a.length?(s.e=new u("Catch filter must inherit from Error or be a simple predicate function"),s):r}var n=e("./util.js"),r=e("./errors.js"),i=n.tryCatch1,s=n.errorObj,o=e("./es5.js").keys,u=r.TypeError;return a.prototype.doFilter=function(n){var o=this._callback,u=this._promise,a=u._boundTo;for(var l=0,c=this._instances.length;l<c;++l){var h=this._instances[l],p=h===Error||h!=null&&h.prototype instanceof Error;if(p&&n instanceof h){var d=i(o,a,n);return d===s?(t.e=d.e,t):d}if(typeof h=="function"&&!p){var v=f(h,n);if(v===s){var m=r.canAttach(s.e)?s.e:new Error(s.e+"");this._promise._attachExtraTrace(m),n=s.e;break}if(v){var d=i(o,a,n);return d===s?(t.e=d.e,t):d}}}return t.e=n,t},a}},{"./errors.js":10,"./es5.js":12,"./util.js":35}],8:[function(e,t,n){var r=e("./util.js"),i=r.isPrimitive,s=r.wrapsPrimitiveReceiver;t.exports=function(e){var t=function(){return this},n=function(){throw this},r=function(t,n){if(n===1)return function(){throw t};if(n===2)return function(){return t}};e.prototype["return"]=e.prototype.thenReturn=function(n){return s&&i(n)?this._then(r(n,2),void 0,void 0,void 0,void 0):this._then(t,void 0,void 0,n,void 0)},e.prototype["throw"]=e.prototype.thenThrow=function(t){return s&&i(t)?this._then(r(t,1),void 0,void 0,void 0,void 0):this._then(n,void 0,void 0,t,void 0)}}},{"./util.js":35}],9:[function(e,t,n){t.exports=function(e,t){var n=e.reduce;e.prototype.each=function(r){return n(this,r,null,t)},e.each=function(r,i){return n(r,i,null,t)}}},{}],10:[function(e,t,n){function u(e){try{o(e,"isOperational",!0)}catch(t){}}function a(e){return e==null?!1:e instanceof E||e.isOperational===!0}function f(e){return e instanceof Error}function l(e){return f(e)}function c(e,t){function n(r){if(!(this instanceof n))return new n(r);this.message=typeof r=="string"?r:t,this.name=e,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}return s(n,Error),n}function E(e){this.name="OperationalError",this.message=e,this.cause=e,this.isOperational=!0,e instanceof Error?(this.message=e.message,this.stack=e.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var r=e("./es5.js").freeze,i=e("./util.js"),s=i.inherits,o=i.notEnumerableProp,h,p,d=c("CancellationError","cancellation error"),v=c("TimeoutError","timeout error"),m=c("AggregateError","aggregate error");try{h=TypeError,p=RangeError}catch(g){h=c("TypeError","type error"),p=c("RangeError","range error")}var y="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" ");for(var b=0;b<y.length;++b)typeof Array.prototype[y[b]]=="function"&&(m.prototype[y[b]]=Array.prototype[y[b]]);m.prototype.length=0,m.prototype.isOperational=!0;var w=0;m.prototype.toString=function(){var e=Array(w*4+1).join(" "),t="\n"+e+"AggregateError of:"+"\n";w++,e=Array(w*4+1).join(" ");for(var n=0;n<this.length;++n){var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n");for(var s=0;s<i.length;++s)i[s]=e+i[s];r=i.join("\n"),t+=r+"\n"}return w--,t},s(E,Error);var S="__BluebirdErrorTypes__",x=Error[S];x||(x=r({CancellationError:d,TimeoutError:v,OperationalError:E,RejectionError:E,AggregateError:m}),o(Error,S,x)),t.exports={Error:Error,TypeError:h,RangeError:p,CancellationError:x.CancellationError,OperationalError:x.OperationalError,TimeoutError:x.TimeoutError,AggregateError:x.AggregateError,originatesFromRejection:a,markAsOriginatingFromRejection:u,canAttach:l}},{"./es5.js":12,"./util.js":35}],11:[function(e,t,n){t.exports=function(t){function r(e){var r=new n(e),i=t.rejected(r),s=i._peekContext();return s!=null&&s._attachExtraTrace(r),i}var n=e("./errors.js").TypeError;return r}},{"./errors.js":10}],12:[function(e,t,n){var r=function(){return this===void 0}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r};else{var i={}.hasOwnProperty,s={}.toString,o={}.constructor.prototype,u=function(t){var n=[];for(var r in t)i.call(t,r)&&n.push(r);return n},a=function(t,n,r){return t[n]=r.value,t},f=function(t){return t},l=function(t){try{return Object(t).constructor.prototype}catch(n){return o}},c=function(t){try{return s.call(t)==="[object Array]"}catch(n){return!1}};t.exports={isArray:c,keys:u,defineProperty:a,freeze:f,getPrototypeOf:l,isES5:r}}},{}],13:[function(e,t,n){t.exports=function(e,t){var n=e.map;e.prototype.filter=function(r,i){return n(this,r,i,t)},e.filter=function(r,i,s){return n(r,i,s,t)}}},{}],14:[function(e,t,n){t.exports=function(t,n,r){function a(){return this}function f(){throw this}function l(e){return function(){return e}}function c(e){return function(){throw e}}function h(e,t,n){var r;return s&&o(t)?r=n?l(t):c(t):r=n?a:f,e._then(r,u,void 0,t,void 0)}function p(e){var i=this.promise,s=this.handler,o=i._isBound()?s.call(i._boundTo):s();if(o!==void 0){var u=r(o,void 0);if(u instanceof t)return h(u,e,i.isFulfilled())}return i.isRejected()?(n.e=e,n):e}function d(e){var n=this.promise,i=this.handler,s=n._isBound()?i.call(n._boundTo,e):i(e);if(s!==void 0){var o=r(s,void 0);if(o instanceof t)return h(o,e,!0)}return e}var i=e("./util.js"),s=i.wrapsPrimitiveReceiver,o=i.isPrimitive,u=i.thrower;t.prototype._passThroughHandler=function(t,n){if(typeof t!="function")return this.then();var r={promise:this,handler:t};return this._then(n?p:d,n?p:void 0,void 0,r,void 0)},t.prototype.lastly=t.prototype["finally"]=function(t){return this._passThroughHandler(t,!0)},t.prototype.tap=function(t){return this._passThroughHandler(t,!1)}}},{"./util.js":35}],15:[function(e,t,n){t.exports=function(t,n,r,i){function h(e,n){var r=f,s=t,o=n.length;for(var u=0;u<o;++u){var a=l(n[u],void 0,e);if(a===r)return s.reject(r.e);var c=i(a,h);if(c instanceof s)return c}return null}function p(e,n,i){var s=this._promise=new t(r);s._setTrace(void 0),this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers=typeof i=="function"?[i].concat(c):c}var s=e("./errors.js"),o=s.TypeError,u=e("./util.js").deprecated,a=e("./util.js"),f=a.errorObj,l=a.tryCatch1,c=[];p.prototype.promise=function(){return this._promise},p.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},p.prototype._continue=function(n){if(n===f){this._generator=void 0;var r=s.canAttach(n.e)?n.e:new Error(n.e+"");this._promise._attachExtraTrace(r),this._promise._reject(n.e,r);return}var u=n.value;if(n.done===!0)this._generator=void 0,this._promise._tryFollow(u)||this._promise._fulfill(u);else{var a=i(u,void 0);if(!(a instanceof t)){a=h(a,this._yieldHandlers);if(a===null){this._throw(new o("A value was yielded that could not be treated as a promise"));return}}a._then(this._next,this._throw,void 0,this,null)}},p.prototype._throw=function(t){s.canAttach(t)&&this._promise._attachExtraTrace(t),this._continue(l(this._generator["throw"],this._generator,t))},p.prototype._next=function(t){this._continue(l(this._generator.next,this._generator,t))},t.coroutine=function(t,n){if(typeof t!="function")throw new o("generatorFunction must be a function");var r=Object(n).yieldHandler,i=p;return function(){var e=t.apply(this,arguments),n=new i(void 0,void 0,r);return n._generator=e,n._next(void 0),n.promise()}},t.coroutine.addYieldHandler=function(e){if(typeof e!="function")throw new o("fn must be a function");c.push(e)},t.spawn=function(r){u("Promise.spawn is deprecated. Use Promise.coroutine instead.");if(typeof r!="function")return n("generatorFunction must be a function");var i=new p(r,this),s=i.promise();return i._run(t.spawn),s}}},{"./errors.js":10,"./util.js":35}],16:[function(e,t,n){t.exports=function(t,n,r,i){var s=e("./util.js"),o=s.canEvaluate,u=s.tryCatch1,a=s.errorObj;if(o){var f=function(e){return new Function("value","holder","                             \n                                                                \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},l=function(e){var t=[];for(var n=1;n<=e;++n)t.push("holder.p"+n);return new Function("holder","                                      \n                                                                \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,t.join(", ")))},c=[],h=[void 0];for(var p=1;p<=5;++p)c.push(f(p)),h.push(l(p));var d=function(e,t){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=t,this.total=e,this.now=0};d.prototype.callers=h,d.prototype.checkFulfillment=function(e){var t=this.now;t++;var n=this.total;if(t>=n){var r=this.callers[n],i=u(r,void 0,this);i===a?e._rejectUnchecked(i.e):e._tryFollow(i)||e._fulfillUnchecked(i)}else this.now=t}}t.join=function(){var s=arguments.length-1,u;if(s>0&&typeof arguments[s]=="function"){u=arguments[s];if(s<6&&o){var a=new t(i);a._setTrace(void 0);var f=new d(s,u),l=a._reject,h=c;for(var p=0;p<s;++p){var v=r(arguments[p],void 0);v instanceof t?v.isPending()?v._then(h[p],l,void 0,a,f):v.isFulfilled()?h[p].call(a,v._settledValue,f):(a._reject(v._settledValue),v._unsetRejectionIsUnhandled()):h[p].call(a,v,f)}return a}}var m=arguments.length,g=new Array(m);for(var y=0;y<m;++y)g[y]=arguments[y];var a=(new n(g)).promise();return u!==void 0?a.spread(u):a}}},{"./util.js":35}],17:[function(e,t,n){t.exports=function(t,n,r,i,s){function c(e,t,n,r){this.constructor$(e),this._callback=t,this._preservedValues=r===s?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=n>=1?[]:l,this._init$(void 0,-2)}function h(e,t,n,r){var i=typeof n=="object"&&n!==null?n.concurrency:0;return i=typeof i=="number"&&isFinite(i)&&i>=1?i:0,new c(e,t,i,r)}var o=e("./util.js"),u=o.tryCatch3,a=o.errorObj,f={},l=[];o.inherits(c,n),c.prototype._init=function(){},c.prototype._promiseFulfilled=function(n,r){var s=this._values;if(s===null)return;var o=this.length(),l=this._preservedValues,c=this._limit;if(s[r]===f){s[r]=n;if(c>=1){this._inFlight--,this._drainQueue();if(this._isResolved())return}}else{if(c>=1&&this._inFlight>=c){s[r]=n,this._queue.push(r);return}l!==null&&(l[r]=n);var h=this._callback,p=this._promise._boundTo,d=u(h,p,n,r,o);if(d===a)return this._reject(d.e);var v=i(d,void 0);if(v instanceof t){if(v.isPending())return c>=1&&this._inFlight++,s[r]=f,v._proxyPromiseArray(this,r);if(!v.isFulfilled())return v._unsetRejectionIsUnhandled(),this._reject(v.reason());d=v.value()}s[r]=d}var m=++this._totalResolved;m>=o&&(l!==null?this._filter(s,l):this._resolve(s))},c.prototype._drainQueue=function(){var t=this._queue,n=this._limit,r=this._values;while(t.length>0&&this._inFlight<n){var i=t.pop();this._promiseFulfilled(r[i],i)}},c.prototype._filter=function(t,n){var r=n.length,i=new Array(r),s=0;for(var o=0;o<r;++o)t[o]&&(i[s++]=n[o]);i.length=s,this._resolve(i)},c.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,n){return typeof t!="function"?r("fn must be a function"):h(this,t,n,null).promise()},t.map=function(t,n,i,s){return typeof n!="function"?r("fn must be a function"):h(t,n,i,s).promise()}}},{"./util.js":35}],18:[function(e,t,n){t.exports=function(t){function u(e){throw e}function a(e,t){if(!n.isArray(e))return f(e,t);var i=n.tryCatchApply(this,[null].concat(e),t);i===o&&r.invokeLater(u,void 0,i.e)}function f(e,t){var n=this,a=e===void 0?s(n,t,null):i(n,t,null,e);a===o&&r.invokeLater(u,void 0,a.e)}function l(e,t){var n=this,i=s(n,t,e);i===o&&r.invokeLater(u,void 0,i.e)}var n=e("./util.js"),r=e("./async.js"),i=n.tryCatch2,s=n.tryCatch1,o=n.errorObj;t.prototype.nodeify=function(t,n){if(typeof t=="function"){var r=f;n!==void 0&&Object(n).spread&&(r=a),this._then(r,l,void 0,t,this._boundTo)}return this}}},{"./async.js":2,"./util.js":35}],19:[function(e,t,n){t.exports=function(t,n){var r=e("./util.js"),i=e("./async.js"),s=e("./errors.js"),o=r.tryCatch1,u=r.errorObj;t.prototype.progressed=function(t){return this._then(void 0,void 0,t,void 0,void 0)},t.prototype._progress=function(t){if(this._isFollowingOrFulfilledOrRejected())return;this._progressUnchecked(t)},t.prototype._clearFirstHandlerData$Base=t.prototype._clearFirstHandlerData,t.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},t.prototype._progressHandlerAt=function(t){return t===0?this._progressHandler0:this[(t<<2)+t-5+2]},t.prototype._doProgressWith=function(n){var r=n.value,i=n.handler,a=n.promise,f=n.receiver,l=o(i,f,r);if(l===u){if(l.e!=null&&l.e.name!=="StopProgressPropagation"){var c=s.canAttach(l.e)?l.e:new Error(l.e+"");a._attachExtraTrace(c),a._progress(l.e)}}else l instanceof t?l._then(a._progress,null,null,a,void 0):a._progress(l)},t.prototype._progressUnchecked=function(r){if(!this.isPending())return;var s=this._length(),o=this._progress;for(var u=0;u<s;u++){var a=this._progressHandlerAt(u),f=this._promiseAt(u);if(!(f instanceof t)){var l=this._receiverAt(u);typeof a=="function"?a.call(l,r,f):l instanceof t&&l._isProxied()?l._progressUnchecked(r):l instanceof n&&l._promiseProgressed(r,f);continue}typeof a=="function"?i.invoke(this._doProgressWith,this,{handler:a,promise:f,receiver:this._receiverAt(u),value:r}):i.invoke(o,f,r)}}}},{"./async.js":2,"./errors.js":10,"./util.js":35}],20:[function(e,t,n){function i(e){try{Promise===e&&(Promise=r)}catch(t){}return e}var r;typeof Promise!="undefined"&&(r=Promise),t.exports=function(){function A(e){if(typeof e!="function")throw new b("the promise constructor requires a resolver function");if(this.constructor!==A)throw new b("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,e!==s&&this._resolveFromResolver(e)}function O(e){return e[0]}var t=e("./util.js"),n=e("./async.js"),r=e("./errors.js"),s=function(){},o={},u={e:null},a=e("./thenables.js")(A,s),f=e("./promise_array.js")(A,s,a),l=e("./captured_trace.js")(),c=e("./catch_filter.js")(u),h=e("./promise_resolver.js"),p=t.isArray,d=t.errorObj,v=t.tryCatch1,m=t.tryCatch2,g=t.tryCatchApply,y=r.RangeError,b=r.TypeError,w=r.CancellationError,E=r.TimeoutError,S=r.OperationalError,x=r.originatesFromRejection,T=r.markAsOriginatingFromRejection,N=r.canAttach,C=t.thrower,k=e("./errors_api_rejection")(A),L=function(){return new b("circular promise resolution chain")};A.prototype.bind=function(t){var n=a(t,void 0),r=new A(s);if(n instanceof A){var i=n.then(function(e){r._setBoundTo(e)}),o=A.all([this,i]).then(O);r._follow(o)}else r._follow(this),r._setBoundTo(t);return r._propagateFrom(this,3),r},A.prototype.toString=function(){return"[object Promise]"},A.prototype.caught=A.prototype["catch"]=function(t){var r=arguments.length;if(r>1){var i=new Array(r-1),s=0,o;for(o=0;o<r-1;++o){var u=arguments[o];if(typeof u!="function"){var a=new b("A catch filter must be an error constructor or a filter function");this._attachExtraTrace(a),n.invoke(this._reject,this,a);return}i[s++]=u}i.length=s,t=arguments[o],this._resetTrace();var f=new c(i,t,this);return this._then(void 0,f.doFilter,void 0,f,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},A.prototype.then=function(t,n,r){return this._then(t,n,r,void 0,void 0)},A.prototype.done=function(t,n,r){var i=this._then(t,n,r,void 0,void 0);i._setIsFinal()},A.prototype.spread=function(t,n){return this._then(t,n,void 0,o,void 0)},A.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},A.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this._settledValue,t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this._settledValue,t.isRejected=!0),t},A.prototype.all=function(){return(new f(this)).promise()},A.is=function(t){return t instanceof A},A.all=function(t){return(new f(t)).promise()},A.prototype.error=function(t){return this.caught(x,t)},A.prototype._resolveFromSyncValue=function(t){if(t===d)this._cleanValues(),this._setRejected(),this._settledValue=t.e,this._ensurePossibleRejectionHandled();else{var n=a(t,void 0);n instanceof A?this._follow(n):(this._cleanValues(),this._setFulfilled(),this._settledValue=t)}},A.method=function(t){if(typeof t!="function")throw new b("fn must be a function");return function(){var n;switch(arguments.length){case 0:n=v(t,this,void 0);break;case 1:n=v(t,this,arguments[0]);break;case 2:n=m(t,this,arguments[0],arguments[1]);break;default:var r=arguments.length,i=new Array(r);for(var o=0;o<r;++o)i[o]=arguments[o];n=g(t,i,this)}var u=new A(s);return u._setTrace(void 0),u._resolveFromSyncValue(n),u}},A.attempt=A["try"]=function(t,n,r){if(typeof t!="function")return k("fn must be a function");var i=p(n)?g(t,n,r):v(t,r,n),o=new A(s);return o._setTrace(void 0),o._resolveFromSyncValue(i),o},A.defer=A.pending=function(){var t=new A(s);return t._setTrace(void 0),new h(t)},A.bind=function(t){var n=a(t,void 0),r=new A(s);r._setTrace(void 0);if(n instanceof A){var i=n.then(function(e){r._setBoundTo(e)});r._follow(i)}else r._setBoundTo(t),r._setFulfilled();return r},A.cast=function(t){var n=a(t,void 0);if(!(n instanceof A)){var r=n;n=new A(s),n._setTrace(void 0),n._setFulfilled(),n._cleanValues(),n._settledValue=r}return n},A.resolve=A.fulfilled=A.cast,A.reject=A.rejected=function(t){var n=new A(s);n._setTrace(void 0),T(t),n._cleanValues(),n._setRejected(),n._settledValue=t;if(!N(t)){var r=new Error(t+"");n._setCarriedStackTrace(r)}return n._ensurePossibleRejectionHandled(),n},A.onPossiblyUnhandledRejection=function(t){l.possiblyUnhandledRejection=typeof t=="function"?t:void 0};var M;A.onUnhandledRejectionHandled=function(t){M=typeof t=="function"?t:void 0};var _=!(typeof process=="undefined"||typeof process.execPath!="string"||typeof process.env!="object"||!process.env.BLUEBIRD_DEBUG&&process.env.NODE_ENV!=="development");A.longStackTraces=function(){if(n.haveItemsQueued()&&_===!1)throw new Error("cannot enable long stack traces after promises have been created");_=l.isSupported()},A.hasLongStackTraces=function(){return _&&l.isSupported()},A.prototype._then=function(t,r,i,o,u){var a=u!==void 0,f=a?u:new A(s);if(!a){if(_){var l=this._peekContext()===this._traceParent;f._traceParent=l?this._traceParent:this}f._propagateFrom(this,7)}var c=this._addCallbacks(t,r,i,f,o);return this.isResolved()&&n.invoke(this._queueSettleAt,this,c),f},A.prototype._length=function(){return this._bitField&262143},A.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0},A.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912},A.prototype._setLength=function(t){this._bitField=this._bitField&-262144|t&262143},A.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456},A.prototype._setRejected=function(){this._bitField=this._bitField|134217728},A.prototype._setFollowing=function(){this._bitField=this._bitField|536870912},A.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432},A.prototype._isFinal=function(){return(this._bitField&33554432)>0},A.prototype._cancellable=function(){return(this._bitField&67108864)>0},A.prototype._setCancellable=function(){this._bitField=this._bitField|67108864},A.prototype._unsetCancellable=function(){this._bitField=this._bitField&-67108865},A.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152},A.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-2097153,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},A.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0},A.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288},A.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-524289},A.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0},A.prototype._setCarriedStackTrace=function(t){this._bitField=this._bitField|1048576,this._fulfillmentHandler0=t},A.prototype._unsetCarriedStackTrace=function(){this._bitField=this._bitField&-1048577,this._fulfillmentHandler0=void 0},A.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0},A.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},A.prototype._receiverAt=function(t){var n=t===0?this._receiver0:this[(t<<2)+t-5+4];return this._isBound()&&n===void 0?this._boundTo:n},A.prototype._promiseAt=function(t){return t===0?this._promise0:this[(t<<2)+t-5+3]},A.prototype._fulfillmentHandlerAt=function(t){return t===0?this._fulfillmentHandler0:this[(t<<2)+t-5+0]},A.prototype._rejectionHandlerAt=function(t){return t===0?this._rejectionHandler0:this[(t<<2)+t-5+1]},A.prototype._addCallbacks=function(t,n,r,i,s){var o=this._length();o>=262138&&(o=0,this._setLength(0));if(o===0)this._promise0=i,s!==void 0&&(this._receiver0=s),typeof t=="function"&&!this._isCarryingStackTrace()&&(this._fulfillmentHandler0=t),typeof n=="function"&&(this._rejectionHandler0=n),typeof r=="function"&&(this._progressHandler0=r);else{var u=(o<<2)+o-5;this[u+3]=i,this[u+4]=s,this[u+0]=typeof t=="function"?t:void 0,this[u+1]=typeof n=="function"?n:void 0,this[u+2]=typeof r=="function"?r:void 0}return this._setLength(o+1),o},A.prototype._setProxyHandlers=function(t,n){var r=this._length();r>=262138&&(r=0,this._setLength(0));if(r===0)this._promise0=n,this._receiver0=t;else{var i=(r<<2)+r-5;this[i+3]=n,this[i+4]=t,this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(r+1)},A.prototype._proxyPromiseArray=function(t,n){this._setProxyHandlers(t,n)},A.prototype._proxyPromise=function(t){t._setProxied(),this._setProxyHandlers(t,-15)},A.prototype._setBoundTo=function(t){t!==void 0?(this._bitField=this._bitField|8388608,this._boundTo=t):this._bitField=this._bitField&-8388609},A.prototype._isBound=function(){return(this._bitField&8388608)===8388608},A.prototype._resolveFromResolver=function(t){function r(e){if(n._tryFollow(e))return;n._fulfill(e)}function i(e){var t=N(e)?e:new Error(e+"");n._attachExtraTrace(t),T(e),n._reject(e,t===e?void 0:t)}var n=this;this._setTrace(void 0),this._pushContext();var s=m(t,void 0,r,i);this._popContext();if(s!==void 0&&s===d){var o=s.e,u=N(o)?o:new Error(o+"");n._reject(o,u)}},A.prototype._spreadSlowCase=function(t,n,r,i){var s=(new f(r)).promise(),u=s._then(function(){return t.apply(i,arguments)},void 0,void 0,o,void 0);n._follow(u)},A.prototype._callSpread=function(t,n,r){var i=this._boundTo;if(p(r))for(var s=0,o=r.length;s<o;++s)if(a(r[s],void 0)instanceof A){this._spreadSlowCase(t,n,r,i);return}return n._pushContext(),g(t,r,i)},A.prototype._callHandler=function(t,n,r,i){var s;return n===o&&!this.isRejected()?s=this._callSpread(t,r,i):(r._pushContext(),s=v(t,n,i)),r._popContext(),s},A.prototype._settlePromiseFromHandler=function(t,n,r,i){if(!(i instanceof A)){t.call(n,r,i);return}var s=this._callHandler(t,n,i,r);if(i._isFollowing())return;if(s===d||s===i||s===u){var o=s===i?L():s.e,f=N(o)?o:new Error(o+"");s!==u&&i._attachExtraTrace(f),i._rejectUnchecked(o,f)}else{var l=a(s,i);if(l instanceof A){if(l.isRejected()&&!l._isCarryingStackTrace()&&!N(l._settledValue)){var f=new Error(l._settledValue+"");i._attachExtraTrace(f),l._setCarriedStackTrace(f)}i._follow(l),i._propagateFrom(l,1)}else i._fulfillUnchecked(s)}},A.prototype._follow=function(t){this._setFollowing(),t.isPending()?(this._propagateFrom(t,1),t._proxyPromise(this)):t.isFulfilled()?this._fulfillUnchecked(t._settledValue):this._rejectUnchecked(t._settledValue,t._getCarriedStackTrace()),t._isRejectionUnhandled()&&t._unsetRejectionIsUnhandled(),_&&t._traceParent==null&&(t._traceParent=this)},A.prototype._tryFollow=function(t){if(this._isFollowingOrFulfilledOrRejected()||t===this)return!1;var n=a(t,void 0);return n instanceof A?(this._follow(n),!0):!1},A.prototype._resetTrace=function(){_&&(this._trace=new l(this._peekContext()===void 0))},A.prototype._setTrace=function(t){if(_){var n=this._peekContext();this._traceParent=n;var r=n===void 0;t!==void 0&&t._traceParent===n?this._trace=t._trace:this._trace=new l(r)}return this},A.prototype._attachExtraTrace=function(t){if(_){var n=this,r=t.stack;r=typeof r=="string"?r.split("\n"):[],l.protectErrorMessageNewlines(r);var i=1,s=1;while(n!=null&&n._trace!=null)r=l.combine(r,n._trace.stack.split("\n")),n=n._traceParent,s++;var o=Error.stackTraceLimit||10,u=(o+i)*s,a=r.length;a>u&&(r.length=u),a>0&&(r[0]=r[0].split("\0").join("\n")),r.length<=i?t.stack="(No stack trace)":t.stack=r.join("\n")}},A.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},A.prototype._propagateFrom=function(t,n){(n&1)>0&&t._cancellable()&&(this._setCancellable(),this._cancellationParent=t),(n&4)>0&&this._setBoundTo(t._boundTo),(n&2)>0&&this._setTrace(t)},A.prototype._fulfill=function(t){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(t)},A.prototype._reject=function(t,n){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(t,n)},A.prototype._settlePromiseAt=function(t){var n=this.isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),r=this._settledValue,i=this._receiverAt(t),s=this._promiseAt(t);if(typeof n=="function")this._settlePromiseFromHandler(n,i,r,s);else{var o=!1,u=this.isFulfilled();i!==void 0&&(i instanceof A&&i._isProxied()?(i._unsetProxied(),u?i._fulfillUnchecked(r):i._rejectUnchecked(r,this._getCarriedStackTrace()),o=!0):i instanceof f&&(u?i._promiseFulfilled(r,s):i._promiseRejected(r,s),o=!0)),o||(u?s._fulfill(r):s._reject(r,this._getCarriedStackTrace()))}t>=4&&this._queueGC()},A.prototype._isProxied=function(){return(this._bitField&4194304)===4194304},A.prototype._setProxied=function(){this._bitField=this._bitField|4194304},A.prototype._unsetProxied=function(){this._bitField=this._bitField&-4194305},A.prototype._isGcQueued=function(){return(this._bitField&-1073741824)===-1073741824},A.prototype._setGcQueued=function(){this._bitField=this._bitField|-1073741824},A.prototype._unsetGcQueued=function(){this._bitField=this._bitField&1073741823},A.prototype._queueGC=function(){if(this._isGcQueued())return;this._setGcQueued(),n.invokeLater(this._gc,this,void 0)},A.prototype._gc=function(){var t=this._length()*5-5;for(var n=0;n<t;n++)delete this[n];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},A.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},A.prototype._queueSettleAt=function(t){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),n.invoke(this._settlePromiseAt,this,t)},A.prototype._fulfillUnchecked=function(t){if(!this.isPending())return;if(t===this){var r=L();return this._attachExtraTrace(r),this._rejectUnchecked(r,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=t;var i=this._length();i>0&&n.invoke(this._settlePromises,this,i)},A.prototype._rejectUncheckedCheckError=function(t){var n=N(t)?t:new Error(t+"");this._rejectUnchecked(t,n===t?void 0:n)},A.prototype._rejectUnchecked=function(t,r){if(!this.isPending())return;if(t===this){var i=L();return this._attachExtraTrace(i),this._rejectUnchecked(i)}this._cleanValues(),this._setRejected(),this._settledValue=t;if(this._isFinal()){n.invokeLater(C,void 0,r===void 0?t:r);return}var s=this._length();r!==void 0&&this._setCarriedStackTrace(r),s>0?n.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()},A.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},A.prototype._settlePromises=function(){var t=this._length();for(var n=0;n<t;n++)this._settlePromiseAt(n)},A.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),l.possiblyUnhandledRejection!==void 0&&n.invokeLater(this._notifyUnhandledRejection,this,void 0)},A.prototype._notifyUnhandledRejectionIsHandled=function(){typeof M=="function"&&n.invokeLater(M,void 0,this)},A.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue,n=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),n!==void 0&&(this._unsetCarriedStackTrace(),t=n),typeof l.possiblyUnhandledRejection=="function"&&l.possiblyUnhandledRejection(t,this)}};var D=[];return A.prototype._peekContext=function(){var t=D.length-1;return t>=0?D[t]:void 0},A.prototype._pushContext=function(){if(!_)return;D.push(this)},A.prototype._popContext=function(){if(!_)return;D.pop()},A.noConflict=function(){return i(A)},A.setScheduler=function(e){if(typeof e!="function")throw new b("fn must be a function");n._schedule=e},l.isSupported()||(A.longStackTraces=function(){},_=!1),A._makeSelfResolutionError=L,e("./finally.js")(A,u,a),e("./direct_resolve.js")(A),e("./synchronous_inspection.js")(A),e("./join.js")(A,f,a,s),A.RangeError=y,A.CancellationError=w,A.TimeoutError=E,A.TypeError=b,A.OperationalError=S,A.RejectionError=S,A.AggregateError=r.AggregateError,t.toFastProperties(A),t.toFastProperties(A.prototype),A.Promise=A,e("./timers.js")(A,s,a),e("./race.js")(A,s,a),e("./call_get.js")(A),e("./generators.js")(A,k,s,a),e("./map.js")(A,f,k,a,s),e("./nodeify.js")(A),e("./promisify.js")(A,s),e("./props.js")(A,f,a),e("./reduce.js")(A,f,k,a,s),e("./settle.js")(A,f),e("./some.js")(A,f,k),e("./progress.js")(A,f),e("./cancel.js")(A,s),e("./filter.js")(A,s),e("./any.js")(A,f),e("./each.js")(A,s),e("./using.js")(A,k,a),A.prototype=A.prototype,A}},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./errors_api_rejection":11,"./filter.js":13,"./finally.js":14,"./generators.js":15,"./join.js":16,"./map.js":17,"./nodeify.js":18,"./progress.js":19,"./promise_array.js":21,"./promise_resolver.js":22,"./promisify.js":23,"./props.js":24,"./race.js":26,"./reduce.js":27,"./settle.js":29,"./some.js":30,"./synchronous_inspection.js":31,"./thenables.js":32,"./timers.js":33,"./using.js":34,"./util.js":35}],21:[function(e,t,n){t.exports=function(t,n,r){function u(e){switch(e){case-1:return void 0;case-2:return[];case-3:return{}}}function a(e){var r=this._promise=new t(n),i=void 0;e instanceof t&&(i=e,r._propagateFrom(i,5)),r._setTrace(i),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var i=e("./errors.js").canAttach,s=e("./util.js"),o=s.isArray;return a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function f(e,n){var i=r(this._values,void 0);if(i instanceof t){this._values=i,i._setBoundTo(this._promise._boundTo);if(!i.isFulfilled()){if(i.isPending()){i._then(f,this._reject,void 0,this,n);return}i._unsetRejectionIsUnhandled(),this._reject(i._settledValue);return}i=i._settledValue;if(!o(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");this.__hardReject__(s);return}}else if(!o(i)){var s=new t.TypeError("expecting an array, a promise or a thenable");this.__hardReject__(s);return}if(i.length===0){n===-5?this._resolveEmptyArray():this._resolve(u(n));return}var a=this.getActualLength(i.length),l=a,c=this.shouldCopyValues()?new Array(a):this._values,h=!1;for(var p=0;p<a;++p){var d=r(i[p],void 0);d instanceof t?d.isPending()?d._proxyPromiseArray(this,p):(d._unsetRejectionIsUnhandled(),h=!0):h=!0,c[p]=d}this._values=c,this._length=l,h&&this._scanDirectValues(a)},a.prototype._settlePromiseAt=function(n){var r=this._values[n];r instanceof t?r.isFulfilled()?this._promiseFulfilled(r._settledValue,n):r.isRejected()&&this._promiseRejected(r._settledValue,n):this._promiseFulfilled(r,n)},a.prototype._scanDirectValues=function(t){for(var n=0;n<t;++n){if(this._isResolved())break;this._settlePromiseAt(n)}},a.prototype._isResolved=function(){return this._values===null},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype.__hardReject__=a.prototype._reject=function(t){this._values=null;var n=i(t)?t:new Error(t+"");this._promise._attachExtraTrace(n),this._promise._reject(t,n)},a.prototype._promiseProgressed=function(t,n){if(this._isResolved())return;this._promise._progress({index:n,value:t})},a.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;this._values[n]=t;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},a.prototype._promiseRejected=function(t,n){if(this._isResolved())return;this._totalResolved++,this._reject(t)},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},{"./errors.js":10,"./util.js":35}],22:[function(e,t,n){function c(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function h(e){var t;return c(e)?t=new u(e):t=e,s.markAsOriginatingFromRejection(t),t}function p(e){function t(t,n){if(e===null)return;if(t){var r=h(i(t));e._attachExtraTrace(r),e._reject(r)}else if(arguments.length>2){var s=arguments.length,o=new Array(s-1);for(var u=1;u<s;++u)o[u-1]=arguments[u];e._fulfill(o)}else e._fulfill(n);e=null}return t}var r=e("./util.js"),i=r.maybeWrapAsError,s=e("./errors.js"),o=s.TimeoutError,u=s.OperationalError,a=e("./async.js"),f=r.haveGetters,l=e("./es5.js"),d;f?d=function(t){this.promise=t}:d=function(t){this.promise=t,this.asCallback=p(t),this.callback=this.asCallback};if(f){var v={get:function(){return p(this.promise)}};l.defineProperty(d.prototype,"asCallback",v),l.defineProperty(d.prototype,"callback",v)}d._nodebackForPromise=p,d.prototype.toString=function(){return"[object PromiseResolver]"},d.prototype.resolve=d.prototype.fulfill=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var n=this.promise;if(n._tryFollow(t))return;a.invoke(n._fulfill,n,t)},d.prototype.reject=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var n=this.promise;s.markAsOriginatingFromRejection(t);var r=s.canAttach(t)?t:new Error(t+"");n._attachExtraTrace(r),a.invoke(n._reject,n,t),r!==t&&a.invoke(this._setCarriedStackTrace,this,r)},d.prototype.progress=function(t){if(!(this instanceof d))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");a.invoke(this.promise._progress,this.promise,t)},d.prototype.cancel=function(){a.invoke(this.promise.cancel,this.promise,void 0)},d.prototype.timeout=function(){this.reject(new o("timeout"))},d.prototype.isResolved=function(){return this.promise.isResolved()},d.prototype.toJSON=function(){return this.promise.toJSON()},d.prototype._setCarriedStackTrace=function(t){this.promise.isRejected()&&this.promise._setCarriedStackTrace(t)},t.exports=d},{"./async.js":2,"./errors.js":10,"./es5.js":12,"./util.js":35}],23:[function(e,t,n){t.exports=function(t,n){function p(e){return e.replace(/([$])/,"\\$")}function d(e){try{return e.__isPromisified__===!0}catch(t){return!1}}function v(e,t,n){var r=i.getDataPropertyOrDefault(e,t+n,h);return r?d(r):!1}function m(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i)){var s=i.replace(n,"");for(var o=0;o<e.length;o+=2)if(e[o]===s)throw new f("Cannot promisify an API that has normal methods with '"+t+"'-suffix")}}}function g(e,t,n,r){var s=i.inheritedDataKeys(e),o=[];for(var u=0;u<s.length;++u){var a=s[u],f=e[a];typeof f=="function"&&!d(f)&&!v(e,a,t)&&r(a,f,e)&&o.push(a,f)}return m(o,t,n),o}function y(e){var t=[e],n=Math.max(0,e-1-5);for(var r=e-1;r>=n;--r){if(r===e)continue;t.push(r)}for(var r=e+1;r<=5;++r)t.push(r);return t}function b(e){return i.filledRange(e,"arguments[","]")}function w(e){return i.filledRange(e,"_arg","")}function E(e){return typeof e.length=="number"?Math.max(Math.min(e.length,1024),0):0}function S(e){return i.isIdentifier(e)?"."+e:"['"+e.replace(/(['\\])/g,"\\$1")+"']"}function x(e,a,f,l,c){function v(t){var n=b(t).join(", "),i=t>0?", ":"",s;return typeof e=="string"?s="                                                          \n                this.method(args, fn);                                       \n                break;                                                       \n            ".replace(".method",S(e)):a===r?s="                                                         \n                callback.call(this, args, fn);                               \n                break;                                                       \n            ":a!==void 0?s="                                                         \n                callback.call(receiver, args, fn);                           \n                break;                                                       \n            ":s="                                                         \n                callback(args, fn);                                          \n                break;                                                       \n            ",s.replace("args",n).replace(", ",i)}function m(){var t="";for(var n=0;n<p.length;++n)t+="case "+p[n]+":"+v(p[n]);var i;return typeof e=="string"?i="                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",S(e)):a===r?i="                                                  \n                callback.apply(this, args);                                  \n            ":i="                                                  \n                callback.apply(receiver, args);                              \n            ",t+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",i),t}var h=Math.max(0,E(l)-1),p=y(h),d=typeof f=="string"&&i.isIdentifier(f)?f+c:"promisified";return(new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n                                                                \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",d).replace("Parameters",w(h)).replace("[CodeForSwitchCase]",m())))(t,e,a,o,u,s,n)}function T(e,i){function a(){var a=i;i===r&&(a=this),typeof e=="string"&&(e=a[e]);var f=new t(n);f._setTrace(void 0);var l=s(f);try{e.apply(a,o(arguments,l))}catch(c){var h=u(c);f._attachExtraTrace(h),f._reject(h)}return f}return a.__isPromisified__=!0,a}function C(e,t,n,s){var o=new RegExp(p(t)+"$"),u=g(e,t,o,n);for(var a=0,f=u.length;a<f;a+=2){var l=u[a],c=u[a+1],h=l+t;e[h]=s===N?N(l,r,l,c,t):s(c)}return i.toFastProperties(e),e}function k(e,t){return N(e,t,void 0,e)}var r={},i=e("./util.js"),s=e("./promise_resolver.js")._nodebackForPromise,o=i.withAppended,u=i.maybeWrapAsError,a=i.canEvaluate,f=e("./errors").TypeError,l="Async",c=function(e,t){return i.isIdentifier(e)&&e.charAt(0)!=="_"&&!i.isClass(t)},h={__isPromisified__:!0},N=a?x:T;t.promisify=function(t,n){if(typeof t!="function")throw new f("fn must be a function");return d(t)?t:k(t,arguments.length<2?r:n)},t.promisifyAll=function(t,n){if(typeof t!="function"&&typeof t!="object")throw new f("the target of promisifyAll must be an object or a function");n=Object(n);var r=n.suffix;typeof r!="string"&&(r=l);var s=n.filter;typeof s!="function"&&(s=c);var o=n.promisifier;typeof o!="function"&&(o=N);if(!i.isIdentifier(r))throw new RangeError("suffix must be a valid identifier");var u=i.inheritedDataKeys(t,{includeHidden:!0});for(var a=0;a<u.length;++a){var h=t[u[a]];u[a]!=="constructor"&&i.isClass(h)&&(C(h.prototype,r,s,o),C(h,r,s,o))}return C(t,r,s,o)}}},{"./errors":10,"./promise_resolver.js":22,"./util.js":35}],24:[function(e,t,n){t.exports=function(t,n,r){function a(e){var t=u.keys(e),n=t.length,r=new Array(n*2);for(var i=0;i<n;++i){var s=t[i];r[i]=e[s],r[i+n]=s}this.constructor$(r)}function f(e){var n,i=r(e,void 0);return o(i)?(i instanceof t?n=i._then(t.props,void 0,void 0,void 0,void 0):n=(new a(i)).promise(),i instanceof t&&n._propagateFrom(i,4),n):s("cannot await properties of a non-object")}var i=e("./util.js"),s=e("./errors_api_rejection")(t),o=i.isObject,u=e("./es5.js");i.inherits(a,n),a.prototype._init=function(){this._init$(void 0,-3)},a.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;this._values[n]=t;var r=++this._totalResolved;if(r>=this._length){var i={},s=this.length();for(var o=0,u=this.length();o<u;++o)i[this._values[o+s]]=this._values[o];this._resolve(i)}},a.prototype._promiseProgressed=function(t,n){if(this._isResolved())return;this._promise._progress({key:this._values[n+this.length()],value:t})},a.prototype.shouldCopyValues=function(){return!1},a.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return f(this)},t.props=function(t){return f(t)}}},{"./errors_api_rejection":11,"./es5.js":12,"./util.js":35}],25:[function(e,t,n){function r(e,t,n,r,i){for(var s=0;s<i;++s)n[s+r]=e[s+t]}function i(e){this._capacity=e,this._length=0,this._front=0,this._makeCapacity()}i.prototype._willBeOverCapacity=function(t){return this._capacity<t},i.prototype._pushOne=function(t){var n=this.length();this._checkCapacity(n+1);var r=this._front+n&this._capacity-1;this[r]=t,this._length=n+1},i.prototype.push=function(t,n,r){var i=this.length()+3;if(this._willBeOverCapacity(i)){this._pushOne(t),this._pushOne(n),this._pushOne(r);return}var s=this._front+i-3;this._checkCapacity(i);var o=this._capacity-1;this[s+0&o]=t,this[s+1&o]=n,this[s+2&o]=r,this._length=i},i.prototype.shift=function(){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,n},i.prototype.length=function(){return this._length},i.prototype._makeCapacity=function(){var t=this._capacity;for(var n=0;n<t;++n)this[n]=void 0},i.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<3)},i.prototype._resizeTo=function(t){var n=this._front,i=this._capacity,s=new Array(i),o=this.length();r(this,0,s,0,i),this._capacity=t,this._makeCapacity(),this._front=0;if(n+o<=i)r(s,n,this,0,o);else{var u=o-(n+o&i-1);r(s,n,this,0,u),r(s,0,this,u,o-u)}},t.exports=i},{}],26:[function(e,t,n){t.exports=function(t,n,r){function a(e,a){var f=r(e,void 0);if(f instanceof t)return o(f);if(!s(e))return i("expecting an array, a promise or a thenable");var l=new t(n);a!==void 0?l._propagateFrom(a,7):l._setTrace(void 0);var c=l._fulfill,h=l._reject;for(var p=0,d=e.length;p<d;++p){var v=e[p];if(v===void 0&&!u.call(e,p))continue;t.cast(v)._then(c,h,void 0,l,null)}return l}var i=e("./errors_api_rejection.js")(t),s=e("./util.js").isArray,o=function(t){return t.then(function(e){return a(e,t)})},u={}.hasOwnProperty;t.race=function(t){return a(t,void 0)},t.prototype.race=function(){return a(this,void 0)}}},{"./errors_api_rejection.js":11,"./util.js":35}],27:[function(e,t,n){t.exports=function(t,n,r,i,s){function l(e,n,r,o){this.constructor$(e),this._preservedValues=o===s?[]:null,this._zerothIsAccum=r===void 0,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=undefined;var u=i(r,void 0),a=!1,f=u instanceof t;f&&(u.isPending()?u._proxyPromiseArray(this,-1):u.isFulfilled()?(r=u.value(),this._gotAccum=!0):(u._unsetRejectionIsUnhandled(),this._reject(u.reason()),a=!0)),!f&&!this._zerothIsAccum&&(this._gotAccum=!0),this._callback=n,this._accum=r,a||this._init$(void 0,-5)}function c(e,t,n,i){if(typeof t!="function")return r("fn must be a function");var s=new l(e,t,n,i);return s.promise()}var o=e("./util.js"),u=o.tryCatch4,a=o.tryCatch3,f=o.errorObj;o.inherits(l,n),l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(this._preservedValues!==null?[]:this._accum)},l.prototype._promiseFulfilled=function(n,r){var s=this._values;if(s===null)return;var o=this.length(),l=this._preservedValues,c=l!==null,h=this._gotAccum,p=this._valuesPhase,d;if(!p){p=this._valuesPhase=Array(o);for(d=0;d<o;++d)p[d]=0}d=p[r],r===0&&this._zerothIsAccum?(h||(this._accum=n,this._gotAccum=h=!0),p[r]=d===0?1:2):r===-1?h||(this._accum=n,this._gotAccum=h=!0):d===0?p[r]=1:(p[r]=2,h&&(this._accum=n));if(!h)return;var v=this._callback,m=this._promise._boundTo,g;for(var y=this._reducingIndex;y<o;++y){d=p[y];if(d===2){this._reducingIndex=y+1;continue}if(d!==1)return;n=s[y];if(n instanceof t){if(!n.isFulfilled()){if(n.isPending())return;return n._unsetRejectionIsUnhandled(),this._reject(n.reason())}n=n._settledValue}c?(l.push(n),g=a(v,m,n,y,o)):g=u(v,m,this._accum,n,y,o);if(g===f)return this._reject(g.e);var b=i(g,void 0);if(b instanceof t){if(b.isPending())return p[y]=4,b._proxyPromiseArray(this,y);if(!b.isFulfilled())return b._unsetRejectionIsUnhandled(),this._reject(b.reason());g=b.value()}this._reducingIndex=y+1,this._accum=g}if(this._reducingIndex<o)return;this._resolve(c?l:this._accum)},t.prototype.reduce=function(t,n){return c(this,t,n,null)},t.reduce=function(t,n,r,i){return c(t,n,r,i)}}},{"./util.js":35}],28:[function(e,t,n){var r,i;if(typeof process=="object"&&typeof process.version=="string")r=function(t){process.nextTick(t)};else if(typeof MutationObserver!="undefined"&&(i=MutationObserver)||typeof WebKitMutationObserver!="undefined"&&(i=WebKitMutationObserver))r=function(){var e=document.createElement("div"),t=void 0,n=new i(function(){var n=t;t=void 0,n()});return n.observe(e,{attributes:!0}),function(r){t=r,e.classList.toggle("foo")}}();else{if(typeof setTimeout=="undefined")throw new Error("no async scheduler available");r=function(t){setTimeout(t,0)}}t.exports=r},{}],29:[function(e,t,n){t.exports=function(t,n){function s(e){this.constructor$(e)}var r=t.PromiseInspection,i=e("./util.js");i.inherits(s,n),s.prototype._promiseResolved=function(t,n){this._values[t]=n;var r=++this._totalResolved;r>=this._length&&this._resolve(this._values)},s.prototype._promiseFulfilled=function(t,n){if(this._isResolved())return;var i=new r;i._bitField=268435456,i._settledValue=t,this._promiseResolved(n,i)},s.prototype._promiseRejected=function(t,n){if(this._isResolved())return;var i=new r;i._bitField=134217728,i._settledValue=t,this._promiseResolved(n,i)},t.settle=function(t){return(new s(t)).promise()},t.prototype.settle=function(){return(new s(this)).promise()}}},{"./util.js":35}],30:[function(e,t,n){t.exports=function(t,n,r){function a(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(e,t){if((t|0)!==t||t<0)return r("expecting a positive integer");var n=new a(e),i=n.promise();return i.isRejected()?i:(n.setHowMany(t),n.init(),i)}var i=e("./util.js"),s=e("./errors.js").RangeError,o=e("./errors.js").AggregateError,u=i.isArray;i.inherits(a,n),a.prototype._init=function(){if(!this._initialized)return;if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-5);var t=u(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))},a.prototype.init=function(){this._initialized=!0,this._init()},a.prototype.setUnwrap=function(){this._unwrap=!0},a.prototype.howMany=function(){return this._howMany},a.prototype.setHowMany=function(t){if(this._isResolved())return;this._howMany=t},a.prototype._promiseFulfilled=function(t){if(this._isResolved())return;this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this.howMany()===1&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},a.prototype._promiseRejected=function(t){if(this._isResolved())return;this._addRejected(t);if(this.howMany()>this._canPossiblyFulfill()){var n=new o;for(var r=this.length();r<this._values.length;++r)n.push(this._values[r]);this._reject(n)}},a.prototype._fulfilled=function(){return this._totalResolved},a.prototype._rejected=function(){return this._values.length-this.length()},a.prototype._addRejected=function(t){this._values.push(t)},a.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},a.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},a.prototype._getRangeError=function(t){var n="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new s(n)},a.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,n){return f(t,n)},t.prototype.some=function(t){return f(this,t)},t._SomePromiseArray=a}},{"./errors.js":10,"./util.js":35}],31:[function(e,t,n){t.exports=function(e){function t(e){e!==void 0?(this._bitField=e._bitField,this._settledValue=e.isResolved()?e._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}t.prototype.isFulfilled=e.prototype.isFulfilled=function(){return(this._bitField&268435456)>0},t.prototype.isRejected=e.prototype.isRejected=function(){return(this._bitField&134217728)>0},t.prototype.isPending=e.prototype.isPending=function(){return(this._bitField&402653184)===0},t.prototype.value=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},t.prototype.error=t.prototype.reason=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},t.prototype.isResolved=e.prototype.isResolved=function(){return(this._bitField&402653184)>0},e.PromiseInspection=t}},{}],32:[function(e,t,n){t.exports=function(t,n){function u(e){try{return e.then}catch(t){return s.e=t,s}}function a(e,r){if(o(e)){if(e instanceof t)return e;if(l(e)){var a=new t(n);return a._setTrace(void 0),e._then(a._fulfillUnchecked,a._rejectUncheckedCheckError,a._progressUnchecked,a,null),a._setFollowing(),a}var f=u(e);if(f===s)return r!==void 0&&i(f.e)&&r._attachExtraTrace(f.e),t.reject(f.e);if(typeof f=="function")return c(e,f,r)}return e}function l(e){return f.call(e,"_promise0")}function c(e,n,r){function f(n){if(o)return;o=!0;if(e===n){var i=t._makeSelfResolutionError();r!==void 0&&r._attachExtraTrace(i),s.promise._reject(i,void 0);return}s.resolve(n)}function l(e){if(o)return;o=!0;var t=i(e)?e:new Error(e+"");r!==void 0&&r._attachExtraTrace(t),s.promise._reject(e,t)}function c(e){if(o)return;var t=s.promise;typeof t._progress=="function"&&t._progress(e)}var s=t.defer(),o=!1;try{n.call(e,f,l,c)}catch(u){if(!o){o=!0;var a=i(u)?u:new Error(u+"");r!==void 0&&r._attachExtraTrace(a),s.promise._reject(u,a)}}return s.promise}var r=e("./util.js"),i=e("./errors.js").canAttach,s=r.errorObj,o=r.isObject,f={}.hasOwnProperty;return a}},{"./errors.js":10,"./util.js":35}],33:[function(e,t,n){var r=function(e,t){var n=arguments.length,r=arguments[2],i=arguments[3],s=n>=5?arguments[4]:void 0;setTimeout(function(){e(r,i,s)},t|0)};t.exports=function(t,n,i){var s=e("./util.js"),o=e("./errors.js"),u=e("./errors_api_rejection")(t),a=t.TimeoutError,f=function(t,n,r){if(!t.isPending())return;typeof n!="string"&&(n="operation timed out after "+r+" ms");var i=new a(n);o.markAsOriginatingFromRejection(i),t._attachExtraTrace(i),t._cancel(i)},l=function(t,n){n._fulfill(t)},c=t.delay=function(s,o){o===void 0&&(o=s,s=void 0),o=+o;var u=i(s,void 0),a=new t(n);return u instanceof t?(a._propagateFrom(u,7),a._follow(u),a.then(function(e){return t.delay(e,o)})):(a._setTrace(void 0),r(l,o,s,a),a)};t.prototype.delay=function(t){return c(this,t)},t.prototype.timeout=function(i,s){i=+i;var o=new t(n);return o._propagateFrom(this,7),o._follow(this),r(f,i,o,s,i),o.cancellable()}}},{"./errors.js":10,"./errors_api_rejection":11,"./util.js":35}],34:[function(e,t,n){t.exports=function(t,n,r){function u(e){var n=e.length;for(var r=0;r<n;++r){var i=e[r];if(i.isRejected())return t.reject(i.error());e[r]=i.value()}return e}function a(e){setTimeout(function(){throw e},0)}function f(e){var t=r(e,void 0);return t!==e&&typeof e._isDisposable=="function"&&typeof e._getDisposer=="function"&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function l(e,n){function u(){if(i>=s)return o.resolve();var l=f(e[i++]);if(l instanceof t&&l._isDisposable()){try{l=r(l._getDisposer().tryDispose(n),void 0)}catch(c){return a(c)}if(l instanceof t)return l._then(u,a,null,null,null)}u()}var i=0,s=e.length,o=t.defer();return u(),o.promise}function c(e){var t=new o;return t._settledValue=e,t._bitField=268435456,l(this,t).thenReturn(e)}function h(e){var t=new o;return t._settledValue=e,t._bitField=134217728,l(this,t).thenThrow(e)}function p(e,t){this._data=e,this._promise=t}function d(e,t){this.constructor$(e,t)}var i=e("./errors.js").TypeError,s=e("./util.js").inherits,o=t.PromiseInspection;p.prototype.data=function(){return this._data},p.prototype.promise=function(){return this._promise},p.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},p.prototype.tryDispose=function(e){var t=this.resource(),n=t!==null?this.doDispose(t,e):null;return this._promise._unsetDisposable(),this._data=this._promise=null,n},p.isDisposer=function(t){return t!=null&&typeof t.resource=="function"&&typeof t.tryDispose=="function"},s(d,p),d.prototype.doDispose=function(e,t){var n=this.data();return n.call(e,e,t)},t.using=function(){var r=arguments.length;if(r<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[r-1];if(typeof i!="function")return n("fn must be a function");r--;var s=new Array(r);for(var o=0;o<r;++o){var a=arguments[o];if(p.isDisposer(a)){var f=a;a=a.promise(),a._setDisposable(f)}s[o]=a}return t.settle(s).then(u).spread(i)._then(c,h,void 0,s,void 0)},t.prototype._setDisposable=function(t){this._bitField=this._bitField|262144,this._disposer=t},t.prototype._isDisposable=function(){return(this._bitField&262144)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-262145,this._disposer=void 0},t.prototype.disposer=function(t){if(typeof t=="function")return new d(t,this);throw new i}}},{"./errors.js":10,"./util.js":35}],35:[function(require,module,exports){function tryCatch1(e,t,n){try{return e.call(t,n)}catch(r){return errorObj.e=r,errorObj}}function tryCatch2(e,t,n,r){try{return e.call(t,n,r)}catch(i){return errorObj.e=i,errorObj}}function tryCatch3(e,t,n,r,i){try{return e.call(t,n,r,i)}catch(s){return errorObj.e=s,errorObj}}function tryCatch4(e,t,n,r,i,s){try{return e.call(t,n,r,i,s)}catch(o){return errorObj.e=o,errorObj}}function tryCatchApply(e,t,n){try{return e.apply(n,t)}catch(r){return errorObj.e=r,errorObj}}function asString(e){return typeof e=="string"?e:""+e}function isPrimitive(e){return e==null||e===!0||e===!1||typeof e=="string"||typeof e=="number"}function isObject(e){return!isPrimitive(e)}function maybeWrapAsError(e){return isPrimitive(e)?new Error(asString(e)):e}function withAppended(e,t){var n=e.length,r=new Array(n+1),i;for(i=0;i<n;++i)r[i]=e[i];return r[i]=t,r}function getDataPropertyOrDefault(e,t,n){if(!es5.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);if(r!=null)return r.get==null&&r.set==null?r.value:n}function notEnumerableProp(e,t,n){if(isPrimitive(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(e,t,r),e}function thrower(e){throw e}function isClass(e){try{if(typeof e=="function"){var t=es5.keys(e.prototype);return t.length>0&&(t.length!==1||t[0]!=="constructor")}return!1}catch(n){return!1}}function toFastProperties(obj){function f(){}return f.prototype=obj,f}function isIdentifier(e){return rident.test(e)}function filledRange(e,t,n){var r=new Array(e);for(var i=0;i<e;++i)r[i]=t+i+n;return r}var es5=require("./es5.js"),haveGetters=function(){try{var e={};return es5.defineProperty(e,"f",{get:function(){return 3}}),e.f===3}catch(t){return!1}}(),canEvaluate=typeof navigator=="undefined",errorObj={e:{}},inherits=function(e,t){function r(){this.constructor=e,this.constructor$=t;for(var r in t.prototype)n.call(t.prototype,r)&&r.charAt(r.length-1)!=="$"&&(this[r+"$"]=t.prototype[r])}var n={}.hasOwnProperty;return r.prototype=t.prototype,e.prototype=new r,e.prototype},wrapsPrimitiveReceiver=function(){return this!=="string"}.call("string"),inheritedDataKeys=function(){return es5.isES5?function(e,t){var n=[],r=Object.create(null),i=Object(t).includeHidden?Object.getOwnPropertyNames:Object.keys;while(e!=null){var s;try{s=i(e)}catch(o){return n}for(var u=0;u<s.length;++u){var a=s[u];if(r[a])continue;r[a]=!0;var f=Object.getOwnPropertyDescriptor(e,a);f!=null&&f.get==null&&f.set==null&&n.push(a)}e=es5.getPrototypeOf(e)}return n}:function(e){var t=[];for(var n in e)t.push(n);return t}}(),rident=/^[a-z$_][a-z$_0-9]*$/i,ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatch3:tryCatch3,tryCatch4:tryCatch4,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties,filledRange:filledRange};module.exports=ret},{"./es5.js":12}]},{},[3])(3)}),define("utils",[],function(){function e(n,r){var i=[];return n.forEach(function(n){if(Array.isArray(n)){var s=r?e(n,!0):t(n);i=i.concat(s)}else i.push(n)}),i}function t(e){var n=[];return e.forEach(function(e){Array.isArray(e)?n.push(t(e)):n.push(e)}),n}function n(e){return e+" *"}function r(e,t){Object.defineProperties(this,{view:{get:function(){return e}},model:{get:function(){return t}}}),this.init()}return Array.prototype.find||(Array.prototype.find=function(e){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof e!="function")throw new TypeError("predicate must be a function");var t=Object(this),n=t.length>>>0,r=arguments[1],i;for(var s=0;s<n;s++){i=t[s];if(e.call(r,i,s,t))return i}return undefined}),r.prototype.init=function(){},{mvcontroller:r,flattenArray:e,allChildren:n,deepcopyArray:t}}),define("onload",["zepto","bluebird","utils"],function(e,t,n){function p(n){return new t(function(t){e(function(e){t(n(e))})})}var r=n.allChildren,i="#control-container",s="#board-square",o="#reset",u="#undo",a="#check",f="#valid-board",l="#invalid-board",c=".square",h=".num-button",d=p(function(e){var t=[],n=e(c).get();for(var r=0;r<3;r++){var i=[];t.push(i);for(var s=0;s<3;s++){var o=[];i.push(o);for(var u=0;u<3;u++){var a=n.splice(0,3);o.push(a)}}}return t}),v=p(function(e){var t=[],n=e(h).get();for(var r=0;r<3;r++){var i=n.splice(0,3);t.push(i)}return t}),m=p(function(e){var t="body,"+r("body"),n=r(s),o=r(i);return e(t).not(n+","+o)}),g=p(function(e){return e(o).get(0)}),y=p(function(e){return e(u).get(0)}),b=p(function(e){return e(a).get(0)}),w=p(function(e){return e(f).get(0)}),E=p(function(e){return e(l).get(0)});return{boardNodesPromise:d,numButtonsPromise:v,focusOutSelectionPromise:m,resetButtonPromise:g,undoButtonPromise:y,checkButtonPromise:b,invalidNotificationPromise:E,validNotificationPromise:w}}),define("viewstate",["onload","utils"],function(e,t){function m(e,t){return e.classList.contains(l)||e.tagName.toUpperCase()===t.toUpperCase()||e.id===t?e:$(e).parents(t).get(0)}function g(e){return!e.classList.contains("inactive")}function y(){S(),N()}function b(e,t){e.classList.remove(f,a),setTimeout(function(){e.classList.add(f)},t)}function w(e){switch(e){case"boardInvalid":b(u.value(),2e3);break;case"boardValid":b(o.value(),2e3);break;case"undoInvalid":break;case"resetWarning":}}function E(e){return m(e,"."+l)}function S(){var e=i.value();$(e).removeClass(c)}function x(e){g(e)&&(S(),e.classList.add(c))}function T(e){return m(e,"button")}function N(){var e=r.value();$(e).removeClass(d)}function C(e){var t=r.value();$(t).removeClass(d),e.classList.add(d)}var n=t.flattenArray,r=e.numButtonsPromise.then(function(e){return n(e,!0)}),i=e.boardNodesPromise.then(function(e){return n(e,!0)}),s=e.focusOutSelectionPromise,o=e.validNotificationPromise,u=e.invalidNotificationPromise,a="hidden",f="fade-hidden",l="square",c="expand-select",h="expand-hover",p="inactive",d="button-select",v="button-hover";return{unselectAll:y,focusOutSelectionPromise:s,pushNotification:w,board:{squaresPromise:i,square:{getClosest:E,insertText:function(e,t){$(e).find("span").text(t)},inactivate:function(e){e.classList.add(p)},unselectAll:S,unfocusAll:function(e){var t=s.value();t.indexOf(e.target)>-1&&S()},onHover:function(e){var t=m(e.target,"."+l);g(t)&&t.classList.add(h)},offHover:function(e){var t=m(e.target,"."+l);t.classList.remove(h)},onSelect:x,onSelectHandler:function(e){var t=m(e.target,"."+l);x(t)}}},numpad:{buttonsPromise:r,button:{getClosest:T,unselectAll:N,unfocusAll:function(e){var t=s.value();t.indexOf(e.target)>-1&&N()},onHover:function(e){var t=m(e.target,"button");t.classList.add(v)},offHover:function(e){var t=m(e.target,"button");t.classList.remove(v)},onSelect:C,onSelectHandler:function(e){var t=m(e.target,"button");C(t)}}},menu:{onHover:function(e){var t=m(e.target,"button");t.classList.add(v)},offHover:function(e){var t=m(e.target,"button");t.classList.remove(v)},onPress:function(e){var t=m(e.target,"button");t.classList.add(d)},offPress:function(e){var t=m(e.target,"button");t.classList.remove(d)}}}}),define("board",["zepto","utils","events","viewstate"],function(e,t,n,r){function a(e,t){var n=e||null,r=t||!1;Object.defineProperties(this,{value:{get:function(){return n},set:function(e){n=e}},immutable:{get:function(){return r}}})}function f(e){var t=e?this.initInput(e):this.initEmpty();Object.defineProperties(this,{data:{get:function(){return t}},flatData:{get:function(){return s(t,!0)}}})}function l(e,t){var n=[];for(var r=0;r<3;r++)n.push(e[r][t]);return n}function c(e){f.call(this,e)}function h(e,t){f.call(this,e);var n=s(o(e),!0);Object.defineProperties(this,{allNodes:{get:function(){return n}}}),this.init(t)}function p(e,t){var n=null;Object.defineProperties(this,{activeSquare:{get:function(){return n},set:function(e){n=e}}}),i.call(this,e,t)}var i=t.mvcontroller,s=t.flattenArray,o=t.deepcopyArray,u=n.dispatcher;return f.prototype.initInput=function(e){var t=o(e);return t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){e.forEach(function(e,t,n){var r;e?r=new a(e,!0):r=new a,n[t]=r})})})}),t},f.prototype.initEmpty=function(){var e=this.data;for(var t=0;t<3;t++){var n=e[t]=[];for(var r=0;r<3;t++){var i=n[r]=[];for(var s=0;s<3;s++){var o=i[s]=[];for(var u=0;u<3;u++)o[u]=new a}}}},f.prototype.row=function(e){var t=[],n=Math.floor(e/3),r=e%3,i=this.data,s=i[n];return s.forEach(function(e){t=t.concat(e[r])}),t},f.prototype.col=function(e){var t=[],n=Math.floor(e/3),r=e%3,i=this.data,s=l(i,n);return s.forEach(function(e){t=t.concat(l(e,r))}),t},f.prototype.subsquare=function(e,t){var n=this.data;return n[e][t]},f.prototype.square=function(e,t){var n=Math.floor(e/3),r=Math.floor(t/3),i=e%3,s=t%3,o=this.subsquare(n,r);return o[i][s]},f.prototype.squareVal=function(e,t,n){var r=this.square(e,t);return n||n===null?(r.value=n,n):r.value},f.prototype.squareIsImmutable=function(e,t){var n=this.square(e,t);return n.immutable},c.prototype=Object.create(f.prototype),h.prototype=Object.create(f.prototype),h.prototype.indexOf=function(e){var t=this.allNodes.indexOf(e),n=Math.floor(t/9),r=Math.floor(n/3),i=n%3,s=Math.floor(t/3)%3,o=t%3;return{row:3*r+s,col:3*i+o}},h.prototype.init=function(e){var t=s(e.data,!0),n=s(this.data,!0),i=r.board.square.inactivate,o=r.board.square.insertText;t.forEach(function(e,t){var r=n[t].value;if(e.value&&e.immutable)o(r,e.value.toString()),i(r);else{var s=e.value||"";o(r,s.toString()),n[t].immutable=!1}})},p.prototype=Object.create(i.prototype),p.prototype.init=function(){var t=this,n=this.view,i=this.model,s=n.allNodes,o=r.board.square.getClosest,a=r.focusOutSelectionPromise.value();e(s).on({click:function(e){var r=o(e.target),s=n.indexOf(r),a=s.row,f=s.col;if(!i.squareIsImmutable(a,f)){var l=i.squareVal(a,f);t.activeSquare=s,u.emit("selectSquare",l)}}}),e(a).on({click:function(e){a.indexOf(e.target)>-1&&(t.activeSquare=null)}}),u.addListener("numpad",function(e){var n=t.activeSquare;if(n){var r=n.row,s=n.col;i.squareIsImmutable(r,s)||(i.squareVal(r,s,e),u.emit("modelUpdate",r,s,e),u.emit("move",r,s,e))}}),u.addListener("undo",function(e,n,r){i.squareVal(e,n,r),t.activeSquare={row:e,col:n},u.emit("modelUpdate",e,n,r)}),this.initViewState()},p.prototype.initViewState=function(){var t=this.view,n=r.board.square.unfocusAll,i=r.board.square.onSelect,s=r.board.square.onSelectHandler,o=r.board.square.onHover,a=r.board.square.offHover,f=r.focusOutSelectionPromise.value(),l=r.board.square.insertText;e(f).on({click:n,doubleTap:n}),e(t.allNodes).on({click:s,mouseenter:o,mouseleave:a}),u.addListener("modelUpdate",function(e,n,r){var s=t.squareVal(e,n);r=r||"",l(s,r.toString()),i(s),u.emit("viewUpdate",e,n)})},{data:c,controller:p,view:h}}),define("numpad",["zepto","events","utils","viewstate"],function(e,t,n,r){function a(e){var t=o(e)||[],n=s(o(t),!0);Object.defineProperties(this,{buttons:{get:function(){return t}},allButtons:{get:function(){return n}}})}function f(e){i.call(this,e)}var i=n.mvcontroller,s=n.flattenArray,o=n.deepcopyArray,u=t.dispatcher;return f.prototype=Object.create(i.prototype),f.prototype.init=function(){var e=this.view,t=e.allButtons,n=r.numpad.button.getClosest;$(t).on("click",function(e){console.log("hi");var t=n(e.target),r=Number(t.name);u.emit("numpad",r)}),this.initViewState()},f.prototype.initViewState=function(){var e=this.view,t=r.numpad.button.onSelect,n=r.numpad.button.onSelectHandler,i=r.numpad.button.onHover,s=r.numpad.button.offHover,o=r.numpad.button.unselectAll,a=r.numpad.button.unfocusAll,f=e.allButtons,l=r.focusOutSelectionPromise.value();u.addListener("selectSquare",function(e){if(e){var n=e-1,r=f[n];t(r)}else o()}),$(l).on({click:a,doubleTap:a}),$(e.allButtons).on({click:n,mouseenter:i,mouseleave:s})},{controller:f,view:a}}),define("game",["board","numpad","events","viewstate","utils","onload"],function(e,t,n,r,i,s){function a(e){var t=[],n=e,r=new c(this);Object.defineProperties(this,{moves:{get:function(){return t}},boardController:{get:function(){return n}},controller:{get:function(){return r}}})}function f(e){var t=[];return e.every(function(e){return e!==null?t[e]?!1:(t[e]=!0,!0):!0})}function l(e){return e.value}function c(e){var t=e;Object.defineProperties(this,{game:{get:function(){return t}}}),this.init()}var o=n.dispatcher,u=i.flattenArray;return a.prototype.boardIsVaild=function(){var e=this.boardController.model,t=this.boardController.model.data,n=u(t);for(var r=0;r<9;r++){var i=u(n[r],!0).map(l),s=e.row(r).map(l),o=e.col(r).map(l);if(!(f(s)&&f(o)&&f(i)))return!1}return!0},a.prototype.pushMove=function(e,t,n){var r={row:e,col:t,val:n};this.moves.push(r)},a.prototype.popMove=function(){return this.moves.pop()},a.prototype.lastMoveAtSquare=function(e,t){var n=this.moves.find(function(n){return n.row===e&&n.col===t});return n||{row:e,col:t,val:null}},a.prototype.handleMove=function(e,t,n){this.pushMove(e,t,n)},a.prototype.handleWin=function(){window.alert("You win!"),o.emit("win")},c.prototype.init=function(){var e=this.game,t=s.undoButtonPromise.value(),n=s.checkButtonPromise.value(),i=r.pushNotification;$(t).on({click:function(){var t=e.popMove();if(t){var n=e.lastMoveAtSquare(t.row,t.col);o.emit("undo",t.row,t.col,n.val)}}}),$(n).on({click:function(){e.boardIsVaild()?i("boardValid"):i("boardInvalid")}}),o.addListener("move",function(t,n,r){e.handleMove(t,n,r)}),this.initViewState()},c.prototype.initViewState=function(){var e=s.undoButtonPromise.value(),t=s.checkButtonPromise.value(),n=r.menu.onPress,i=r.menu.offPress,o=r.menu.onHover,u=r.menu.offHover;$([e,t]).on({mouseenter:o,mouseleave:function(e){u(e),i(e)},mousedown:n,mouseup:i})},{construct:a,controller:c}}),define("modelstate",[],function(){var e=[[[[5,3,0],[6,0,0],[0,9,8]],[[0,7,0],[1,9,5],[0,0,0]],[[0,0,0],[0,0,0],[0,6,0]]],[[[8,0,0],[4,0,0],[7,0,0]],[[0,6,0],[8,0,3],[0,2,0]],[[0,0,3],[0,0,1],[0,0,6]]],[[[0,6,0],[0,0,0],[0,0,0]],[[0,0,0],[4,1,9],[0,8,0]],[[2,8,0],[0,0,5],[0,7,9]]]];return{boardData:e}}),require.config({baseUrl:"./app/scripts",paths:{zepto:"vendor/zepto-full/zepto",eventEmitter:"vendor/eventEmitter/EventEmitter",bluebird:"vendor/bluebird/js/browser/bluebird"},shim:{zepto:{deps:[],exports:"Zepto"},bluebird:{deps:[],exports:"Promise"}}}),require(["zepto","events","onload","board","game","numpad","viewstate","modelstate","utils"],function(e,t,n,r,i,s,o,u,a){function _(){M=new b(N),c.then(function(e){C=new w(e,M),k=new E(C,M),L=new T(k)}),p.then(function(e){A=new S(e),O=new x(A)})}function D(){e(v.value()).off(),e(h.value()).off(),e(d.value()).off(),e(g.value()).off(),e(y.value()).off()}function P(){D(),f.removeAllListeners()}function H(){P(),_(),o.unselectAll(),f.emit("reset")}var f=t.dispatcher,l=a.flattenArray,c=n.boardNodesPromise,h=c.then(function(e){return l(e,!0)}),p=n.numButtonsPromise,d=p.then(function(e){return l(e,!0)}),v=n.focusOutSelectionPromise,m=n.resetButtonPromise,g=n.checkButtonPromise,y=n.undoButtonPromise,b=r.data,w=r.view,E=r.controller,S=s.view,x=s.controller,T=i.construct,N=u.boardData,C,k,L,A,O,M;m.then(function(t){e(t).on({click:H,mouseenter:o.menu.onHover,mouseleave:function(e){o.menu.offHover(e),o.menu.offPress(e)},mousedown:o.menu.onPress,mouseup:o.menu.offPress})}),_()}),define("main",function(){});